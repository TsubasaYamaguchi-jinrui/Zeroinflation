<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 ゼロ過剰二項モデルとは | Zero-inflated model using R</title>
  <meta name="description" content="3 ゼロ過剰二項モデルとは | Zero-inflated model using R" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="3 ゼロ過剰二項モデルとは | Zero-inflated model using R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 ゼロ過剰二項モデルとは | Zero-inflated model using R" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-10-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Chapter2.html"/>
<link rel="next" href="sessioninfo.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="Chapter0.html"><a href="Chapter0.html"><i class="fa fa-check"></i>0 パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="Chapter1.html"><a href="Chapter1.html"><i class="fa fa-check"></i><b>1</b> 一般化線形モデル(GLM)における過分散</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Chapter1.html"><a href="Chapter1.html#二項分布とポワソン分布の特徴"><i class="fa fa-check"></i><b>1.1</b> 二項分布とポワソン分布の特徴</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="Chapter1.html"><a href="Chapter1.html#二項分布"><i class="fa fa-check"></i><b>1.1.1</b> 二項分布</a></li>
<li class="chapter" data-level="1.1.2" data-path="Chapter1.html"><a href="Chapter1.html#c1.2.2"><i class="fa fa-check"></i><b>1.1.2</b> ポワソン分布</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="Chapter1.html"><a href="Chapter1.html#過分散とは"><i class="fa fa-check"></i><b>1.2</b> 過分散とは</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="Chapter1.html"><a href="Chapter1.html#過分散の例"><i class="fa fa-check"></i><b>1.2.1</b> 過分散の例</a></li>
<li class="chapter" data-level="1.2.2" data-path="Chapter1.html"><a href="Chapter1.html#過分散の問題点"><i class="fa fa-check"></i><b>1.2.2</b> 過分散の問題点</a></li>
<li class="chapter" data-level="1.2.3" data-path="Chapter1.html"><a href="Chapter1.html#過分散が生じる要因とゼロ過剰"><i class="fa fa-check"></i><b>1.2.3</b> 過分散が生じる要因とゼロ過剰</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chapter2.html"><a href="Chapter2.html"><i class="fa fa-check"></i><b>2</b> ゼロ過剰ポワソンモデルとは</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Chapter2.html"><a href="Chapter2.html#ポワソン回帰でゼロ過剰が生じる例"><i class="fa fa-check"></i><b>2.1</b> ポワソン回帰でゼロ過剰が生じる例</a></li>
<li class="chapter" data-level="2.2" data-path="Chapter2.html"><a href="Chapter2.html#対処法-ゼロ過剰ポワソンモデル"><i class="fa fa-check"></i><b>2.2</b> 対処法: ゼロ過剰ポワソンモデル</a></li>
<li class="chapter" data-level="2.3" data-path="Chapter2.html"><a href="Chapter2.html#ゼロ過剰ポワソンモデルの分析例"><i class="fa fa-check"></i><b>2.3</b> ゼロ過剰ポワソンモデルの分析例</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chapter3.html"><a href="Chapter3.html"><i class="fa fa-check"></i><b>3</b> ゼロ過剰二項モデルとは</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Chapter3.html"><a href="Chapter3.html#ロジスティック回帰でゼロ過剰が生じる例"><i class="fa fa-check"></i><b>3.1</b> ロジスティック回帰でゼロ過剰が生じる例</a></li>
<li class="chapter" data-level="3.2" data-path="Chapter3.html"><a href="Chapter3.html#対処法-ゼロ過剰二項モデル"><i class="fa fa-check"></i><b>3.2</b> 対処法: ゼロ過剰二項モデル</a></li>
<li class="chapter" data-level="3.3" data-path="Chapter3.html"><a href="Chapter3.html#ゼロ過剰二項モデルの分析例1glmの場合"><i class="fa fa-check"></i><b>3.3</b> ゼロ過剰二項モデルの分析例1(GLMの場合)</a></li>
<li class="chapter" data-level="3.4" data-path="Chapter3.html"><a href="Chapter3.html#ゼロ過剰二項モデルの分析例2glmmの場合"><i class="fa fa-check"></i><b>3.4</b> ゼロ過剰二項モデルの分析例2(GLMMの場合)</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="Chapter3.html"><a href="Chapter3.html#普通のglmmを適用する"><i class="fa fa-check"></i><b>3.4.1</b> 普通のGLMMを適用する</a></li>
<li class="chapter" data-level="3.4.2" data-path="Chapter3.html"><a href="Chapter3.html#ゼロ過剰二項モデル"><i class="fa fa-check"></i><b>3.4.2</b> ゼロ過剰二項モデル</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Zero-inflated model using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ゼロ過剰二項モデルとは" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> ゼロ過剰二項モデルとは<a href="Chapter3.html#ゼロ過剰二項モデルとは" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>以下では、同様に応答変数が二項分布に従うと仮定したときにゼロ過剰が生じる場合について見ていく。</p>
<div id="ロジスティック回帰でゼロ過剰が生じる例" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> ロジスティック回帰でゼロ過剰が生じる例<a href="Chapter3.html#ロジスティック回帰でゼロ過剰が生じる例" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ニホンザルのメスが群れ外オスから攻撃された直後に怪我が確認されるか否かを調べた結果、以下のデータ(<code>dat_zibinom</code>)が得られたとする。なお、<code>sum</code>は攻撃された回数を、<code>num_inj</code>は攻撃の直後に怪我が確認された回数を、<code>age</code>はメスの年齢を表す。</p>
<p>シミュレーションによって架空のデータを作成する。</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="Chapter3.html#cb46-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb46-2"><a href="Chapter3.html#cb46-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb46-3"><a href="Chapter3.html#cb46-3" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">15</span>, <span class="fl">3.5</span>)</span>
<span id="cb46-4"><a href="Chapter3.html#cb46-4" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="fu">rpois</span>(N,<span class="dv">100</span>)</span>
<span id="cb46-5"><a href="Chapter3.html#cb46-5" tabindex="-1"></a></span>
<span id="cb46-6"><a href="Chapter3.html#cb46-6" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">exp</span>((<span class="fl">0.8</span> <span class="sc">-</span> <span class="fl">0.08</span><span class="sc">*</span>age))<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>((<span class="fl">0.8</span> <span class="sc">-</span> <span class="fl">0.08</span><span class="sc">*</span>age)))</span>
<span id="cb46-7"><a href="Chapter3.html#cb46-7" tabindex="-1"></a></span>
<span id="cb46-8"><a href="Chapter3.html#cb46-8" tabindex="-1"></a>num_inj <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb46-9"><a href="Chapter3.html#cb46-9" tabindex="-1"></a></span>
<span id="cb46-10"><a href="Chapter3.html#cb46-10" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb46-11"><a href="Chapter3.html#cb46-11" tabindex="-1"></a>  num_inj[i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span><span class="sc">-</span>p[i])<span class="sc">*</span><span class="fu">rbinom</span>(<span class="dv">1</span>, sum[i], <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">5.5</span> <span class="sc">+</span> <span class="fl">0.12</span><span class="sc">*</span>age[i])<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">5.5</span> <span class="sc">+</span> <span class="fl">0.12</span><span class="sc">*</span>age[i])))</span>
<span id="cb46-12"><a href="Chapter3.html#cb46-12" tabindex="-1"></a>}</span>
<span id="cb46-13"><a href="Chapter3.html#cb46-13" tabindex="-1"></a></span>
<span id="cb46-14"><a href="Chapter3.html#cb46-14" tabindex="-1"></a>dat_zibinom <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> age,</span>
<span id="cb46-15"><a href="Chapter3.html#cb46-15" tabindex="-1"></a>           <span class="at">num_inj =</span> num_inj,</span>
<span id="cb46-16"><a href="Chapter3.html#cb46-16" tabindex="-1"></a>           <span class="at">sum =</span> sum)</span></code></pre></div>
<p>作成されたデータがこちら。</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="Chapter3.html#cb47-1" tabindex="-1"></a>dat_zibinom <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="Chapter3.html#cb47-2" tabindex="-1"></a>  <span class="fu">datatable</span>()</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-351f7141167e28cd0735" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-351f7141167e28cd0735">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200"],[10.775269877151,15.9710023473873,18.7955441183907,6.79005804079728,16.5019364108387,16.7711956225515,12.9884101395287,13.0867885047553,13.0244180031735,11.8848675983456,13.3298255508626,11.505647442991,12.283111368767,15.2256058604669,18.3582292063977,14.6140007696323,13.2114667296768,11.8108160417957,12.0698991190587,23.4554231247127,15.4693087705321,13.2825993615817,13.4580824467637,16.6085630435205,12.5719791357188,9.93128281364735,17.0116450231525,11.4172049696264,14.9470159487254,11.7241798959106,18.8580414117009,13.3354242239583,12.5169598687062,13.2455967879183,9.29817285822454,10.9133325826703,7.36986122867964,10.3065238276499,13.969971494327,13.3693586085786,20.073236928505,11.259750467139,12.0062237819187,14.0178194931489,11.5198097329652,11.6101998874478,11.1243863257538,10.6180494002637,13.1666015835443,13.2610251495665,8.67889060119318,12.9627342635873,11.1188863145063,11.447632966778,14.4319166675511,16.9706953664808,20.7673611548527,12.2932630161971,20.6206837010005,10.9476700830696,17.2980596251648,23.9214687475125,14.8783386356866,12.6562824711831,14.9733833550116,21.219795568502,11.0148729213718,19.7873951279814,19.6534767677383,16.1776547902134,15.0241249345469,13.405859416435,13.7171662349412,17.269002986261,22.2459480146583,14.4631055563656,10.1325466865448,12.4674637801145,15.9039161675875,13.8902930976358,14.377735148175,14.4050207310091,10.1969433994316,14.3917449035509,17.9758128999266,17.4416304908389,16.9249907288189,13.5904380859333,14.3294218033253,10.8191524213912,14.8139441343984,15.8931860034854,20.9708740253403,18.5052963832721,13.2654579494949,16.2444260394991,11.0288718476315,18.073712694333,18.4052086368164,22.4239098688149,16.4508323703124,13.3384853426472,15.2309772279656,13.2413277616215,12.1090049450473,15.5844624791354,11.8630738081433,15.5886488567951,16.242388913552,14.817632090951,14.3142288344931,12.7282558693798,11.1158146901044,17.9724597092927,15.0782688412661,17.9089921605739,10.6449925202952,15.5915924481816,17.3560820743169,14.9080326824302,14.3301274100539,12.2633267365504,22.2035669571722,17.6267550860454,21.384729058324,15.280208743822,12.7900674536177,9.70349157988196,12.7736505912023,15.7920553637401,18.5479162161301,15.8846254727322,10.8981809050561,17.3405001498376,9.22464672804474,13.7195171313283,13.8935858490842,8.18113883437521,18.2202013283682,12.8199494179239,13.8308717250089,19.8830176238537,17.2283604386363,14.6204890605337,16.7981697244164,16.3974513254589,20.8199975660064,15.9656269125492,16.7719541812269,16.2164319125833,13.6796682337629,15.3416681208823,20.735606257926,11.9354263403365,15.4261599952437,19.7674573129574,14.1788261957705,11.3131601721992,11.9557573802743,13.6345553962353,12.0342747440465,14.0877621276521,13.5495310278034,14.359322207982,16.424696342582,17.1862159487075,20.8737201029665,14.7595722125225,13.8770603056964,20.1485200096712,20.9651528923948,15.1513541314514,13.8356993830327,8.62217603852917,19.9394183956137,12.068461480731,11.0668302196164,25.6531806013335,15.8225745788773,14.8835948646034,5.43723166965469,14.6507329404534,18.4161110722284,16.4485412040788,18.1931275656354,21.9430627023953,19.0918797990477,13.2194204460467,17.4646306246293,14.3055430416227,13.116752238903,5.00484470743268,12.2362360170768,16.7073512230729,22.5881138883176,16.7524311499828,17.1707357128356,11.6193387645325,15.5692914784139,7.72616860339418],[3,0,3,0,0,0,4,4,1,2,1,0,0,2,0,0,1,2,3,3,1,0,0,2,1,3,4,0,1,1,6,0,0,4,0,0,0,0,3,2,12,0,0,0,4,0,0,0,0,0,0,0,2,2,5,5,3,3,4,4,0,0,0,2,0,0,0,0,7,0,1,0,0,4,9,5,1,0,3,1,0,0,2,2,0,0,4,2,0,2,1,2,5,3,3,3,0,2,4,5,0,0,2,3,0,1,0,1,1,3,3,1,0,0,3,2,0,0,3,4,4,0,6,5,3,0,0,1,1,2,2,3,0,3,0,1,0,0,0,3,1,1,5,0,2,3,7,0,5,3,0,0,6,0,1,5,3,0,0,0,0,4,4,0,0,2,0,3,2,2,0,5,0,0,3,3,2,7,3,3,2,1,0,5,3,0,6,0,4,0,0,1,0,0,0,0,2,1,2,0],[104,106,101,107,103,107,118,111,100,88,113,87,83,94,98,93,115,102,111,100,101,103,81,129,106,93,83,97,91,103,120,99,89,104,89,105,89,113,104,102,102,104,110,104,106,88,116,102,107,86,109,96,108,82,93,108,125,104,100,102,92,109,120,93,90,99,103,89,111,110,102,84,91,97,101,109,101,82,119,102,111,102,104,105,88,90,97,100,93,85,95,99,83,95,116,102,102,101,109,110,95,100,94,111,108,104,98,100,81,102,108,94,94,88,93,97,116,87,109,111,101,111,92,86,94,102,99,88,84,119,88,98,119,109,119,99,98,94,77,103,99,122,93,126,106,109,112,113,102,103,101,102,101,94,109,103,84,96,121,81,107,104,105,100,90,111,94,91,97,114,88,108,98,96,92,97,94,115,104,91,87,91,101,106,101,115,101,87,117,97,91,120,100,113,94,87,101,93,101,90]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>age<\/th>\n      <th>num_inj<\/th>\n      <th>sum<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><br/></p>
<p>サルの年齢(<code>age</code>)と攻撃の直後に怪我が確認された割合(<code>num_inj</code>/<code>sum</code>)をプロットしたところ、以下のようになった。年齢が高くなるほど、怪我が確認された割合が多くなるように見える。</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="Chapter3.html#cb48-1" tabindex="-1"></a>dat_zibinom <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="Chapter3.html#cb48-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> num_inj<span class="sc">/</span>sum))<span class="sc">+</span></span>
<span id="cb48-3"><a href="Chapter3.html#cb48-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb48-4"><a href="Chapter3.html#cb48-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb48-5"><a href="Chapter3.html#cb48-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span> <span class="fl">0.8</span>,</span>
<span id="cb48-6"><a href="Chapter3.html#cb48-6" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>,</span>
<span id="cb48-7"><a href="Chapter3.html#cb48-7" tabindex="-1"></a>                                    <span class="at">vjust=</span><span class="fl">0.5</span>,</span>
<span id="cb48-8"><a href="Chapter3.html#cb48-8" tabindex="-1"></a>                                    <span class="at">size =</span> <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb48-9"><a href="Chapter3.html#cb48-9" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.122</span>))<span class="sc">+</span></span>
<span id="cb48-10"><a href="Chapter3.html#cb48-10" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.15</span>,<span class="fl">0.02</span>))<span class="sc">+</span></span>
<span id="cb48-11"><a href="Chapter3.html#cb48-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;怪</span><span class="sc">\n</span><span class="st">我</span><span class="sc">\n</span><span class="st">が</span><span class="sc">\n</span><span class="st">確</span><span class="sc">\n</span><span class="st">認</span><span class="sc">\n</span><span class="st">さ</span><span class="sc">\n</span><span class="st">れ</span><span class="sc">\n</span><span class="st">た</span><span class="sc">\n</span><span class="st">割</span><span class="sc">\n</span><span class="st">合&quot;</span>)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-38-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>そこで、以下のようなGLMを考え、年齢が怪我が確認された割合に影響するかを調べる。</p>
<ul>
<li>分布: 二項分布<br />
</li>
<li>リンク関数: logit関数<br />
</li>
<li>応答変数: 怪我が確認された割合(<code>num_inj</code>/<code>sum</code>)<br />
</li>
<li>説明変数: 年齢(<code>age</code>)</li>
</ul>
<p>数式で表すと以下のようになる。ただし、<span class="math inline">\(i\)</span>は各データポイントのIDを示す。例えば、<span class="math inline">\(age_i\)</span>は、<span class="math inline">\(i\)</span>番目の個体の年齢を表す。ただし、<span class="math inline">\(i = 1,2,3,...,200\)</span>である。</p>
<p>なお、<span class="math inline">\(num\_inj_i \sim Binomial(sum_i,p_i)\)</span>は、i番目の個体に怪我が確認された回数が試行数<span class="math inline">\(sum_i\)</span>、確率(<span class="math inline">\(p_i\)</span>)の二項分布に従って得られるということを示す。</p>
<p><span class="math display">\[
\begin{aligned}
logit(p_i) &amp;= log(\frac{p_i}{1-p_i}) = \beta_0 + \beta_{2} \times age_i\\
num\_inj_i &amp;\sim Binomial(trials_i, p_i)
\end{aligned}
\]</span></p>
<p>RでのGLMのコードは以下のようになる。</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="Chapter3.html#cb49-1" tabindex="-1"></a>r_binom <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> dat_zibinom,</span>
<span id="cb49-2"><a href="Chapter3.html#cb49-2" tabindex="-1"></a>              <span class="fu">cbind</span>(num_inj, sum<span class="sc">-</span>num_inj) <span class="sc">~</span> age,</span>
<span id="cb49-3"><a href="Chapter3.html#cb49-3" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link=</span>logit))</span></code></pre></div>
<p>結果は以下のようになり、<span class="math inline">\(\beta_0\)</span>の推定値は-6.045、<span class="math inline">\(\beta_1\)</span>の推定値は0.128である。</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="Chapter3.html#cb50-1" tabindex="-1"></a><span class="fu">summary</span>(r_binom)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cbind(num_inj, sum - num_inj) ~ age, family = binomial(link = logit), 
##     data = dat_zibinom)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.2819  -1.5432  -0.3570   0.9607   3.9672  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -6.04528    0.24236 -24.944   &lt;2e-16 ***
## age          0.12802    0.01432   8.938   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 495.59  on 199  degrees of freedom
## Residual deviance: 418.10  on 198  degrees of freedom
## AIC: 746.05
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>つまり、怪我が確認される回数は試行数<span class="math inline">\(sum_i\)</span>、<span class="math inline">\(p_i = \frac{1}{1 + -e^{-6,045 + 0.128 \times age_i}}\)</span>となる二項分布から得られると推定される(<span class="math inline">\(log(\frac{p_i}{1-p_i}) = \beta_0 + \beta_{2} \times age_i\)</span>より)。</p>
<p>そこで、推定したパラメータを持つモデルの下で得られるデータをシミュレートし(<code>num_inj_sim</code>)、それを実際に得られたデータと比較してみる。</p>
<p>下の図からわかるように、実際に得られたデータから算出された怪我が観察された割合(<code>prop_inj</code>)では、<strong>推定されたモデルからシミュレートされたデータ</strong>(<code>prop_inj_sim</code>)<strong>より0が多い</strong>(= ゼロ過剰が生じている)。<u>怪我がをしていても体毛に隠れていて気づかない場合があったなど、0が増えてしまう何らかのメカニズムがあったと推測される</u>。</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="Chapter3.html#cb52-1" tabindex="-1"></a><span class="do">## モデルの下で得られるデータをシミュレート  </span></span>
<span id="cb52-2"><a href="Chapter3.html#cb52-2" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>(<span class="fu">coef</span>(r_binom)[[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">coef</span>(r_binom)[[<span class="dv">2</span>]]<span class="sc">*</span>dat_zibinom<span class="sc">$</span>age)))</span>
<span id="cb52-3"><a href="Chapter3.html#cb52-3" tabindex="-1"></a></span>
<span id="cb52-4"><a href="Chapter3.html#cb52-4" tabindex="-1"></a>num_inj_sim <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, dat_zibinom<span class="sc">$</span>sum, p)</span>
<span id="cb52-5"><a href="Chapter3.html#cb52-5" tabindex="-1"></a>prop_inj_sim <span class="ot">&lt;-</span> num_inj_sim<span class="sc">/</span>dat_zibinom<span class="sc">$</span>sum</span>
<span id="cb52-6"><a href="Chapter3.html#cb52-6" tabindex="-1"></a></span>
<span id="cb52-7"><a href="Chapter3.html#cb52-7" tabindex="-1"></a><span class="do">## 実際のデータと比較  </span></span>
<span id="cb52-8"><a href="Chapter3.html#cb52-8" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">prop_inj =</span> num_inj<span class="sc">/</span>dat_zibinom<span class="sc">$</span>sum,</span>
<span id="cb52-9"><a href="Chapter3.html#cb52-9" tabindex="-1"></a>           <span class="at">prop_inj_sim =</span> prop_inj_sim) <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="Chapter3.html#cb52-10" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-11"><a href="Chapter3.html#cb52-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value))<span class="sc">+</span></span>
<span id="cb52-12"><a href="Chapter3.html#cb52-12" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">fill =</span> name),</span>
<span id="cb52-13"><a href="Chapter3.html#cb52-13" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb52-14"><a href="Chapter3.html#cb52-14" tabindex="-1"></a>                 <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb52-15"><a href="Chapter3.html#cb52-15" tabindex="-1"></a>                 <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.2</span>,<span class="at">by=</span><span class="fl">0.01</span>))<span class="sc">+</span></span>
<span id="cb52-16"><a href="Chapter3.html#cb52-16" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">13</span>)<span class="sc">+</span></span>
<span id="cb52-17"><a href="Chapter3.html#cb52-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.8</span>,</span>
<span id="cb52-18"><a href="Chapter3.html#cb52-18" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>,<span class="at">vjust=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb52-19"><a href="Chapter3.html#cb52-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;怪我が確認された割合&quot;</span>,</span>
<span id="cb52-20"><a href="Chapter3.html#cb52-20" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;度</span><span class="sc">\n</span><span class="st">数&quot;</span>)<span class="sc">+</span></span>
<span id="cb52-21"><a href="Chapter3.html#cb52-21" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.13</span>))<span class="sc">+</span></span>
<span id="cb52-22"><a href="Chapter3.html#cb52-22" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>,<span class="st">&quot;black&quot;</span>))<span class="ot">-&gt;</span> p_binom_hist</span>
<span id="cb52-23"><a href="Chapter3.html#cb52-23" tabindex="-1"></a></span>
<span id="cb52-24"><a href="Chapter3.html#cb52-24" tabindex="-1"></a>p_binom_hist</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-41-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>検定をすると、ゼロ過剰が検出される。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="Chapter3.html#cb53-1" tabindex="-1"></a><span class="fu">testZeroInflation</span>(r_binom)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-42-1.png" width="432" style="display: block; margin: auto;" /></p>
<pre><code>## 
##  DHARMa zero-inflation test via comparison to expected zeros with
##  simulation under H0 = fitted model
## 
## data:  simulationOutput
## ratioObsSim = 1.8522, p-value &lt; 2.2e-16
## alternative hypothesis: two.sided</code></pre>
<p>dispersion parameterを算出すると、二項分布での規定値(= 1)を越えており、過分散が生じていることが分かる。おそらくゼロ過剰が原因だろう。</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="Chapter3.html#cb55-1" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">residuals</span>(r_binom,<span class="at">type =</span> <span class="st">&quot;pearson&quot;</span>)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>r_binom<span class="sc">$</span>df.residual</span></code></pre></div>
<pre><code>## [1] 1.806725</code></pre>
<p>検定を行っても過分散が検出された。</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="Chapter3.html#cb57-1" tabindex="-1"></a>resid_binom <span class="ot">&lt;-</span><span class="fu">simulateResiduals</span>(r_binom)</span>
<span id="cb57-2"><a href="Chapter3.html#cb57-2" tabindex="-1"></a></span>
<span id="cb57-3"><a href="Chapter3.html#cb57-3" tabindex="-1"></a><span class="fu">testDispersion</span>(resid_binom)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-44-1.png" width="432" style="display: block; margin: auto;" /></p>
<pre><code>## 
##  DHARMa nonparametric dispersion test via sd of residuals fitted vs.
##  simulated
## 
## data:  simulationOutput
## dispersion = 1.6742, p-value &lt; 2.2e-16
## alternative hypothesis: two.sided</code></pre>
<p>QQplotをみても、データがモデルによく当てはまっていないことが分かる。</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="Chapter3.html#cb59-1" tabindex="-1"></a><span class="fu">plotQQunif</span>(resid_binom)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-45-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>このモデルの推定結果に基づく回帰曲線は以下のようになる。</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="Chapter3.html#cb60-1" tabindex="-1"></a>fit_binom <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(r_binom,</span>
<span id="cb60-2"><a href="Chapter3.html#cb60-2" tabindex="-1"></a>          <span class="do">## 温度は5~15で0.1刻み</span></span>
<span id="cb60-3"><a href="Chapter3.html#cb60-3" tabindex="-1"></a>          <span class="at">terms =</span> <span class="st">&quot;age[5:26,by=0.1]&quot;</span>,</span>
<span id="cb60-4"><a href="Chapter3.html#cb60-4" tabindex="-1"></a>          <span class="do">## ここを変える</span></span>
<span id="cb60-5"><a href="Chapter3.html#cb60-5" tabindex="-1"></a>          <span class="at">type =</span><span class="st">&quot;fixed&quot;</span>)</span>
<span id="cb60-6"><a href="Chapter3.html#cb60-6" tabindex="-1"></a></span>
<span id="cb60-7"><a href="Chapter3.html#cb60-7" tabindex="-1"></a><span class="fu">ggplot</span>(dat_zibinom)<span class="sc">+</span></span>
<span id="cb60-8"><a href="Chapter3.html#cb60-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> num_inj<span class="sc">/</span>sum),</span>
<span id="cb60-9"><a href="Chapter3.html#cb60-9" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb60-10"><a href="Chapter3.html#cb60-10" tabindex="-1"></a>  <span class="do">### 回帰曲線</span></span>
<span id="cb60-11"><a href="Chapter3.html#cb60-11" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fit_binom,</span>
<span id="cb60-12"><a href="Chapter3.html#cb60-12" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> predicted))<span class="sc">+</span></span>
<span id="cb60-13"><a href="Chapter3.html#cb60-13" tabindex="-1"></a>  <span class="do">## 95%信頼区間</span></span>
<span id="cb60-14"><a href="Chapter3.html#cb60-14" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> fit_binom,</span>
<span id="cb60-15"><a href="Chapter3.html#cb60-15" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> predicted,</span>
<span id="cb60-16"><a href="Chapter3.html#cb60-16" tabindex="-1"></a>                <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb60-17"><a href="Chapter3.html#cb60-17" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb60-18"><a href="Chapter3.html#cb60-18" tabindex="-1"></a>   <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)<span class="sc">+</span></span>
<span id="cb60-19"><a href="Chapter3.html#cb60-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span> <span class="fl">0.8</span>,</span>
<span id="cb60-20"><a href="Chapter3.html#cb60-20" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>,</span>
<span id="cb60-21"><a href="Chapter3.html#cb60-21" tabindex="-1"></a>                                    <span class="at">vjust=</span><span class="fl">0.5</span>,</span>
<span id="cb60-22"><a href="Chapter3.html#cb60-22" tabindex="-1"></a>                                    <span class="at">size =</span><span class="dv">10</span>),</span>
<span id="cb60-23"><a href="Chapter3.html#cb60-23" tabindex="-1"></a>        <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>))<span class="sc">+</span></span>
<span id="cb60-24"><a href="Chapter3.html#cb60-24" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.122</span>))<span class="sc">+</span></span>
<span id="cb60-25"><a href="Chapter3.html#cb60-25" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.15</span>,<span class="fl">0.02</span>))<span class="sc">+</span></span>
<span id="cb60-26"><a href="Chapter3.html#cb60-26" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;普通の二項分布モデル&quot;</span>,</span>
<span id="cb60-27"><a href="Chapter3.html#cb60-27" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;怪</span><span class="sc">\n</span><span class="st">我</span><span class="sc">\n</span><span class="st">が</span><span class="sc">\n</span><span class="st">確</span><span class="sc">\n</span><span class="st">認</span><span class="sc">\n</span><span class="st">さ</span><span class="sc">\n</span><span class="st">れ</span><span class="sc">\n</span><span class="st">た</span><span class="sc">\n</span><span class="st">割</span><span class="sc">\n</span><span class="st">合&quot;</span>)<span class="ot">-&gt;</span> p_binom</span>
<span id="cb60-28"><a href="Chapter3.html#cb60-28" tabindex="-1"></a></span>
<span id="cb60-29"><a href="Chapter3.html#cb60-29" tabindex="-1"></a>p_binom</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-46-1.png" width="432" style="display: block; margin: auto;" /></p>
</div>
<div id="対処法-ゼロ過剰二項モデル" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> 対処法: ゼロ過剰二項モデル<a href="Chapter3.html#対処法-ゼロ過剰二項モデル" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>こうしたゼロ過剰のデータに対する対処法の1つが、ポワソン分布の場合と同様に、ゼロ過剰を仮定したモデル(<strong>ゼロ過剰二項モデル</strong>)を用いることである。ゼロ過剰二項モデルでも、ゼロ過剰ポワソンモデルのように2段階の過程で<span class="math inline">\(i\)</span>番目のデータ(<span class="math inline">\(y_i\)</span>)が得られると仮定する。</p>
<p>➀ 確率<span class="math inline">\(q_i\)</span>でデータが必ず0になる。<br />
➁ <span class="math inline">\(1-q_i\)</span>の確率で、データ<span class="math inline">\(y_i\)</span>が確率<span class="math inline">\(p_i\)</span>、試行数<span class="math inline">\(n_i\)</span>の二項分布に従って得られる。</p>
<p>すなわち、<strong>ゼロ過剰モデルは2種類のプロセスから得られた0が存在することを仮定</strong>する。すなわち、ある確率<span class="math inline">\(q_i\)</span>で必ず0が得られるとき(1)と、<span class="math inline">\(1-q_i\)</span>の確率でデータが二項分布に従う場合に0が得られるとき(2)である。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-47"></span>
<img src="image/zibinom_process.png" alt="ゼロ過剰二項モデルでデータが得られる過程" width="1991" />
<p class="caption">
図3.1: ゼロ過剰二項モデルでデータが得られる過程
</p>
</div>
<p>ゼロ過剰二項分布において、0が得られる確率は以下のようになる。</p>
<p><span class="math display">\[
q_i + (1-q_i)\times _n C _0 p_i^0(1-p_i)^{n_i-0} \\
= q_i + (1-q_i)\times (1-p_i)^{n_i}
\]</span></p>
<p>一方で、0以外が得られる確率は以下のようになる。<br />
<span class="math display">\[
(1-q_i)\times _n C _0 p_i^x(1-p_i)^{n_i-x} \; (x&gt;0)
\]</span></p>
</div>
<div id="ゼロ過剰二項モデルの分析例1glmの場合" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> ゼロ過剰二項モデルの分析例1(GLMの場合)<a href="Chapter3.html#ゼロ過剰二項モデルの分析例1glmの場合" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>それでは、先ほどのデータをゼロ過剰二項モデルに当てはめよう。データが以下の式に従って得られると仮定する。モデルでは、<span class="math inline">\(q_i\)</span>も年齢によって変化すると仮定する(年齢によらないと仮定することもできる)。なお、<span class="math inline">\(num\_inj_i \sim ZIBinomial(p_i)\)</span>は怪我が確認された回数がゼロ過剰二項モデルに従って得られることを示す。</p>
<p><span class="math display">\[
\begin{aligned}
logit(q_i) &amp;= log(\frac{q_i}{1-q_i}) = \beta_{10} + \beta_{11} \times age_i\\
logit(p_i) &amp;= log(\frac{p_i}{1-p_i}) = \beta_{20} + \beta_{21} \times age_i\\
num\_inj_i &amp;\sim ZIBinomial(q_i, trials_i, p_i)
\end{aligned}
\]</span></p>
<p>Rでは<code>glmmTMB</code>パッケージを用いて以下のようにパラメータを推定できる。<span class="math inline">\(q_i\)</span>が年齢によらないと仮定する場合は、<code>ziformula ~ 1</code>とする。</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="Chapter3.html#cb61-1" tabindex="-1"></a>r_zibinom <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(<span class="at">data =</span> dat_zibinom,</span>
<span id="cb61-2"><a href="Chapter3.html#cb61-2" tabindex="-1"></a>                    <span class="fu">cbind</span>(num_inj, sum <span class="sc">-</span> num_inj) <span class="sc">~</span> age,</span>
<span id="cb61-3"><a href="Chapter3.html#cb61-3" tabindex="-1"></a>        <span class="do">## 年齢によらないとする場合はziformula~1</span></span>
<span id="cb61-4"><a href="Chapter3.html#cb61-4" tabindex="-1"></a>                    <span class="at">ziformula =</span> <span class="sc">~</span>age,</span>
<span id="cb61-5"><a href="Chapter3.html#cb61-5" tabindex="-1"></a>                    <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span></code></pre></div>
<p>モデルで推定されたパラメータは以下のようになる。</p>
<p><code>Zero-inflation model:</code>というところにある推定結果が<span class="math inline">\(q_i\)</span>に関するパラメータの推定値であり、<span class="math inline">\(\beta_{10}\)</span>と<span class="math inline">\(\beta_{11}\)</span>の推定値はそれぞれ0.574、-0.079となる。</p>
<p><code>Conditional model:</code>というところにある推定結果が<span class="math inline">\(p_i\)</span>に関するパラメータの推定値であり、<span class="math inline">\(\beta_{20}\)</span>と<span class="math inline">\(\beta_{21}\)</span>の推定値はそれぞれ-5.292、0.107となる。</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="Chapter3.html#cb62-1" tabindex="-1"></a><span class="fu">summary</span>(r_zibinom)</span></code></pre></div>
<pre><code>##  Family: binomial  ( logit )
## Formula:          cbind(num_inj, sum - num_inj) ~ age
## Zero inflation:                                 ~age
## Data: dat_zibinom
## 
##      AIC      BIC   logLik deviance df.resid 
##    658.3    671.5   -325.2    650.3      196 
## 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -5.29156    0.29761 -17.780  &lt; 2e-16 ***
## age          0.10687    0.01708   6.255 3.96e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Zero-inflation model:
##             Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)  0.57401    0.80218   0.716    0.474
## age         -0.07934    0.05112  -1.552    0.121</code></pre>
<p>推定されたたパラメータを持つゼロ過剰二項モデルの下で得られるデータをシミュレートし(<code>num_inj_zisim</code>)、それを実際に得られたデータと比較してみる。</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="Chapter3.html#cb64-1" tabindex="-1"></a><span class="do">## 推定されたパラメータからデータをシミュレート</span></span>
<span id="cb64-2"><a href="Chapter3.html#cb64-2" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>(<span class="fu">fixef</span>(r_zibinom)[[<span class="dv">2</span>]][[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">fixef</span>(r_zibinom)[[<span class="dv">2</span>]][[<span class="dv">2</span>]]<span class="sc">*</span>dat_zibinom<span class="sc">$</span>age)))</span>
<span id="cb64-3"><a href="Chapter3.html#cb64-3" tabindex="-1"></a></span>
<span id="cb64-4"><a href="Chapter3.html#cb64-4" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>(<span class="fu">fixef</span>(r_zibinom)[[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">fixef</span>(r_zibinom)[[<span class="dv">1</span>]][[<span class="dv">2</span>]]<span class="sc">*</span>dat_zibinom<span class="sc">$</span>age)))</span>
<span id="cb64-5"><a href="Chapter3.html#cb64-5" tabindex="-1"></a></span>
<span id="cb64-6"><a href="Chapter3.html#cb64-6" tabindex="-1"></a>num_inj_zisim <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="dv">1</span>,<span class="dv">1</span><span class="sc">-</span>q)<span class="sc">*</span><span class="fu">rbinom</span>(N,dat_zibinom<span class="sc">$</span>sum, p)</span>
<span id="cb64-7"><a href="Chapter3.html#cb64-7" tabindex="-1"></a></span>
<span id="cb64-8"><a href="Chapter3.html#cb64-8" tabindex="-1"></a>prop_inj_zisim <span class="ot">&lt;-</span> num_inj_zisim<span class="sc">/</span>dat_zibinom<span class="sc">$</span>sum</span></code></pre></div>
<p>下の図からわかるように、ゼロ過剰二項モデルからシミュレートされたデータから算出した怪我が観察された割合(<code>prop_inj_zisim</code>)の分布は、さきほどよりも実際のデータにマッチしていることが分かる。</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="Chapter3.html#cb65-1" tabindex="-1"></a><span class="do">## 実際のデータと比較  </span></span>
<span id="cb65-2"><a href="Chapter3.html#cb65-2" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">prop_inj =</span> dat_zibinom<span class="sc">$</span>num_inj<span class="sc">/</span>dat_zibinom<span class="sc">$</span>sum,</span>
<span id="cb65-3"><a href="Chapter3.html#cb65-3" tabindex="-1"></a>           <span class="at">prop_inj_zisim =</span> prop_inj_zisim) <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="Chapter3.html#cb65-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-5"><a href="Chapter3.html#cb65-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value))<span class="sc">+</span></span>
<span id="cb65-6"><a href="Chapter3.html#cb65-6" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">fill =</span> name),</span>
<span id="cb65-7"><a href="Chapter3.html#cb65-7" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb65-8"><a href="Chapter3.html#cb65-8" tabindex="-1"></a>                 <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb65-9"><a href="Chapter3.html#cb65-9" tabindex="-1"></a>                 <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.13</span>,<span class="fl">0.01</span>))<span class="sc">+</span></span>
<span id="cb65-10"><a href="Chapter3.html#cb65-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">13</span>)<span class="sc">+</span></span>
<span id="cb65-11"><a href="Chapter3.html#cb65-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.8</span>,</span>
<span id="cb65-12"><a href="Chapter3.html#cb65-12" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>,<span class="at">vjust=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb65-13"><a href="Chapter3.html#cb65-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;怪我が確認された割合&quot;</span>,</span>
<span id="cb65-14"><a href="Chapter3.html#cb65-14" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;度</span><span class="sc">\n</span><span class="st">数&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-15"><a href="Chapter3.html#cb65-15" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>,<span class="st">&quot;red3&quot;</span>)) <span class="ot">-&gt;</span> p_zibinom_hist</span>
<span id="cb65-16"><a href="Chapter3.html#cb65-16" tabindex="-1"></a></span>
<span id="cb65-17"><a href="Chapter3.html#cb65-17" tabindex="-1"></a>p_zibinom_hist</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-51-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>これは、普通の二項分布モデルの結果(<code>prop_inj_sim</code>)と比較すると明白である。</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="Chapter3.html#cb66-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">prop_inj =</span> dat_zibinom<span class="sc">$</span>num_inj<span class="sc">/</span>dat_zibinom<span class="sc">$</span>sum,</span>
<span id="cb66-2"><a href="Chapter3.html#cb66-2" tabindex="-1"></a>           <span class="at">prop_inj_zisim =</span> prop_inj_zisim,</span>
<span id="cb66-3"><a href="Chapter3.html#cb66-3" tabindex="-1"></a>           <span class="at">prop_inj_sim =</span> prop_inj_sim) <span class="sc">%&gt;%</span>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb66-4"><a href="Chapter3.html#cb66-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">fct_relevel</span>(name,<span class="st">&quot;prop_inj&quot;</span>,<span class="st">&quot;prop_inj_zisim&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb66-5"><a href="Chapter3.html#cb66-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value))<span class="sc">+</span></span>
<span id="cb66-6"><a href="Chapter3.html#cb66-6" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">fill =</span> name),</span>
<span id="cb66-7"><a href="Chapter3.html#cb66-7" tabindex="-1"></a>                 <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb66-8"><a href="Chapter3.html#cb66-8" tabindex="-1"></a>                 <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.13</span>,<span class="fl">0.01</span>))<span class="sc">+</span></span>
<span id="cb66-9"><a href="Chapter3.html#cb66-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">13</span>)<span class="sc">+</span></span>
<span id="cb66-10"><a href="Chapter3.html#cb66-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.8</span>,</span>
<span id="cb66-11"><a href="Chapter3.html#cb66-11" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>,<span class="at">vjust=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb66-12"><a href="Chapter3.html#cb66-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;怪我が確認された割合&quot;</span>,</span>
<span id="cb66-13"><a href="Chapter3.html#cb66-13" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;度</span><span class="sc">\n</span><span class="st">数&quot;</span>) <span class="sc">+</span></span>
<span id="cb66-14"><a href="Chapter3.html#cb66-14" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>,<span class="st">&quot;red3&quot;</span>,<span class="st">&quot;black&quot;</span>)) </span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-52-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>検定をしても、ゼロ過剰は検出されない。</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="Chapter3.html#cb67-1" tabindex="-1"></a><span class="fu">testZeroInflation</span>(r_zibinom)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-53-1.png" width="432" style="display: block; margin: auto;" /></p>
<pre><code>## 
##  DHARMa zero-inflation test via comparison to expected zeros with
##  simulation under H0 = fitted model
## 
## data:  simulationOutput
## ratioObsSim = 1.0061, p-value = 0.92
## alternative hypothesis: two.sided</code></pre>
<p>検定を行っても過分散は検出されない。</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="Chapter3.html#cb69-1" tabindex="-1"></a>resid_zibinom <span class="ot">&lt;-</span><span class="fu">simulateResiduals</span>(r_zibinom)</span>
<span id="cb69-2"><a href="Chapter3.html#cb69-2" tabindex="-1"></a></span>
<span id="cb69-3"><a href="Chapter3.html#cb69-3" tabindex="-1"></a><span class="fu">testDispersion</span>(resid_zibinom)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-54-1.png" width="432" style="display: block; margin: auto;" /></p>
<pre><code>## 
##  DHARMa nonparametric dispersion test via sd of residuals fitted vs.
##  simulated
## 
## data:  simulationOutput
## dispersion = 0.99165, p-value = 0.984
## alternative hypothesis: two.sided</code></pre>
<p>QQplotをみても、データがモデルによく当てはまっていることが分かる。</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="Chapter3.html#cb71-1" tabindex="-1"></a><span class="fu">plotQQunif</span>(resid_zibinom)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-55-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>推定されたモデルに基づく回帰曲線を描画する。<br />
確率<span class="math inline">\(q_i\)</span>で得られた0を含まないものと、含むものを両方描ける。</p>
<p><span class="math inline">\(q_i\)</span>で得られた0を<strong>含まない</strong>場合</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="Chapter3.html#cb72-1" tabindex="-1"></a>fit_zibinom_a <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(r_zibinom,</span>
<span id="cb72-2"><a href="Chapter3.html#cb72-2" tabindex="-1"></a>          <span class="do">## 温度は5~15で0.1刻み</span></span>
<span id="cb72-3"><a href="Chapter3.html#cb72-3" tabindex="-1"></a>          <span class="at">terms =</span> <span class="st">&quot;age[5:26,by=0.1]&quot;</span>,</span>
<span id="cb72-4"><a href="Chapter3.html#cb72-4" tabindex="-1"></a>          <span class="at">type =</span><span class="st">&quot;fixed&quot;</span>)</span>
<span id="cb72-5"><a href="Chapter3.html#cb72-5" tabindex="-1"></a></span>
<span id="cb72-6"><a href="Chapter3.html#cb72-6" tabindex="-1"></a><span class="fu">ggplot</span>(dat_zibinom)<span class="sc">+</span></span>
<span id="cb72-7"><a href="Chapter3.html#cb72-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> num_inj<span class="sc">/</span>sum),</span>
<span id="cb72-8"><a href="Chapter3.html#cb72-8" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb72-9"><a href="Chapter3.html#cb72-9" tabindex="-1"></a>  <span class="do">### 回帰曲線</span></span>
<span id="cb72-10"><a href="Chapter3.html#cb72-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fit_zibinom_a,</span>
<span id="cb72-11"><a href="Chapter3.html#cb72-11" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> predicted))<span class="sc">+</span></span>
<span id="cb72-12"><a href="Chapter3.html#cb72-12" tabindex="-1"></a>  <span class="do">## 95%信頼区間</span></span>
<span id="cb72-13"><a href="Chapter3.html#cb72-13" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> fit_zibinom_a,</span>
<span id="cb72-14"><a href="Chapter3.html#cb72-14" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> predicted,</span>
<span id="cb72-15"><a href="Chapter3.html#cb72-15" tabindex="-1"></a>                <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb72-16"><a href="Chapter3.html#cb72-16" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb72-17"><a href="Chapter3.html#cb72-17" tabindex="-1"></a>   <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)<span class="sc">+</span></span>
<span id="cb72-18"><a href="Chapter3.html#cb72-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span> <span class="fl">0.8</span>,</span>
<span id="cb72-19"><a href="Chapter3.html#cb72-19" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>,</span>
<span id="cb72-20"><a href="Chapter3.html#cb72-20" tabindex="-1"></a>                                    <span class="at">vjust=</span><span class="fl">0.5</span>,</span>
<span id="cb72-21"><a href="Chapter3.html#cb72-21" tabindex="-1"></a>                                    <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb72-22"><a href="Chapter3.html#cb72-22" tabindex="-1"></a>        <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>))<span class="sc">+</span></span>
<span id="cb72-23"><a href="Chapter3.html#cb72-23" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.122</span>))<span class="sc">+</span></span>
<span id="cb72-24"><a href="Chapter3.html#cb72-24" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.15</span>,<span class="fl">0.02</span>))<span class="sc">+</span></span>
<span id="cb72-25"><a href="Chapter3.html#cb72-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;ゼロ過剰二項モデル</span><span class="sc">\n</span><span class="st">(qによる0含まず)&quot;</span>,</span>
<span id="cb72-26"><a href="Chapter3.html#cb72-26" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;怪</span><span class="sc">\n</span><span class="st">我</span><span class="sc">\n</span><span class="st">が</span><span class="sc">\n</span><span class="st">確</span><span class="sc">\n</span><span class="st">認</span><span class="sc">\n</span><span class="st">さ</span><span class="sc">\n</span><span class="st">れ</span><span class="sc">\n</span><span class="st">た</span><span class="sc">\n</span><span class="st">割</span><span class="sc">\n</span><span class="st">合&quot;</span>)<span class="ot">-&gt;</span> p_zibinom_a</span></code></pre></div>
<p><span class="math inline">\(q_i\)</span>で得られた0を<strong>含む</strong>場合</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="Chapter3.html#cb73-1" tabindex="-1"></a>fit_zibinom_b <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(r_zibinom,</span>
<span id="cb73-2"><a href="Chapter3.html#cb73-2" tabindex="-1"></a>          <span class="do">## 温度は5~15で0.1刻み</span></span>
<span id="cb73-3"><a href="Chapter3.html#cb73-3" tabindex="-1"></a>          <span class="at">terms =</span> <span class="st">&quot;age[5:26,by=0.1]&quot;</span>,</span>
<span id="cb73-4"><a href="Chapter3.html#cb73-4" tabindex="-1"></a>          <span class="at">type =</span><span class="st">&quot;zero_inflated&quot;</span>)</span>
<span id="cb73-5"><a href="Chapter3.html#cb73-5" tabindex="-1"></a></span>
<span id="cb73-6"><a href="Chapter3.html#cb73-6" tabindex="-1"></a><span class="fu">ggplot</span>(dat_zibinom)<span class="sc">+</span></span>
<span id="cb73-7"><a href="Chapter3.html#cb73-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> num_inj<span class="sc">/</span>sum),</span>
<span id="cb73-8"><a href="Chapter3.html#cb73-8" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb73-9"><a href="Chapter3.html#cb73-9" tabindex="-1"></a>  <span class="do">### 回帰曲線</span></span>
<span id="cb73-10"><a href="Chapter3.html#cb73-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fit_zibinom_b,</span>
<span id="cb73-11"><a href="Chapter3.html#cb73-11" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> predicted))<span class="sc">+</span></span>
<span id="cb73-12"><a href="Chapter3.html#cb73-12" tabindex="-1"></a>  <span class="do">## 95%信頼区間</span></span>
<span id="cb73-13"><a href="Chapter3.html#cb73-13" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> fit_zibinom_b,</span>
<span id="cb73-14"><a href="Chapter3.html#cb73-14" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> predicted,</span>
<span id="cb73-15"><a href="Chapter3.html#cb73-15" tabindex="-1"></a>                <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb73-16"><a href="Chapter3.html#cb73-16" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb73-17"><a href="Chapter3.html#cb73-17" tabindex="-1"></a>   <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)<span class="sc">+</span></span>
<span id="cb73-18"><a href="Chapter3.html#cb73-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span> <span class="fl">0.8</span>,</span>
<span id="cb73-19"><a href="Chapter3.html#cb73-19" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>,</span>
<span id="cb73-20"><a href="Chapter3.html#cb73-20" tabindex="-1"></a>                                    <span class="at">vjust=</span><span class="fl">0.5</span>,</span>
<span id="cb73-21"><a href="Chapter3.html#cb73-21" tabindex="-1"></a>                                    <span class="at">size =</span><span class="dv">10</span>),</span>
<span id="cb73-22"><a href="Chapter3.html#cb73-22" tabindex="-1"></a>        <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>))<span class="sc">+</span></span>
<span id="cb73-23"><a href="Chapter3.html#cb73-23" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.122</span>))<span class="sc">+</span></span>
<span id="cb73-24"><a href="Chapter3.html#cb73-24" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.15</span>,<span class="fl">0.02</span>))<span class="sc">+</span></span>
<span id="cb73-25"><a href="Chapter3.html#cb73-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;ゼロ過剰二項モデル</span><span class="sc">\n</span><span class="st">(qによる0含む)&quot;</span>,</span>
<span id="cb73-26"><a href="Chapter3.html#cb73-26" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;怪</span><span class="sc">\n</span><span class="st">我</span><span class="sc">\n</span><span class="st">が</span><span class="sc">\n</span><span class="st">確</span><span class="sc">\n</span><span class="st">認</span><span class="sc">\n</span><span class="st">さ</span><span class="sc">\n</span><span class="st">れ</span><span class="sc">\n</span><span class="st">た</span><span class="sc">\n</span><span class="st">割</span><span class="sc">\n</span><span class="st">合&quot;</span>)<span class="ot">-&gt;</span> p_zibinom_b</span></code></pre></div>
<p>比較のため、普通のポワソン回帰による回帰曲線も併置する。</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="Chapter3.html#cb74-1" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb74-2"><a href="Chapter3.html#cb74-2" tabindex="-1"></a></span>
<span id="cb74-3"><a href="Chapter3.html#cb74-3" tabindex="-1"></a>p_binom <span class="sc">+</span> p_zibinom_a <span class="sc">+</span> p_zibinom_b <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-58-1.png" width="1248" style="display: block; margin: auto;" /></p>
</div>
<div id="ゼロ過剰二項モデルの分析例2glmmの場合" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> ゼロ過剰二項モデルの分析例2(GLMMの場合)<a href="Chapter3.html#ゼロ過剰二項モデルの分析例2glmmの場合" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ゼロ過剰モデルはランダム効果が含まれる一般化線形モデル(GLMM)についても適用できる。先ほどと同様に
ニホンザルのメスが群れ外オスから攻撃された直後に怪我が確認されるか否かを調べたとする。今度は先ほどとは異なり5年分のデータがある、すなわち同じメスについて5つのデータポイントがあるとする(<code>dat_zibinomglmm</code>)。なお、<code>femaleID</code>はメスのIDを、<code>sum</code>は攻撃された回数を、<code>num_inj</code>は攻撃の直後に怪我が確認された回数を、<code>age</code>はメスの年齢を表す。</p>
<p>シミュレーションによって架空のデータを作成する。</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="Chapter3.html#cb75-1" tabindex="-1"></a><span class="do">## データの作成</span></span>
<span id="cb75-2"><a href="Chapter3.html#cb75-2" tabindex="-1"></a></span>
<span id="cb75-3"><a href="Chapter3.html#cb75-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb75-4"><a href="Chapter3.html#cb75-4" tabindex="-1"></a></span>
<span id="cb75-5"><a href="Chapter3.html#cb75-5" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb75-6"><a href="Chapter3.html#cb75-6" tabindex="-1"></a>femaleID <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">1</span>,N<span class="sc">/</span><span class="dv">5</span>,<span class="at">by=</span><span class="dv">1</span>),<span class="at">each=</span><span class="dv">5</span>)</span>
<span id="cb75-7"><a href="Chapter3.html#cb75-7" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(N<span class="sc">/</span><span class="dv">5</span>, <span class="dv">15</span>, <span class="fl">3.5</span>), <span class="at">each =</span> <span class="dv">5</span>)</span>
<span id="cb75-8"><a href="Chapter3.html#cb75-8" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rpois</span>(N<span class="sc">/</span><span class="dv">5</span>,<span class="dv">100</span>), <span class="at">each =</span> <span class="dv">5</span>)</span>
<span id="cb75-9"><a href="Chapter3.html#cb75-9" tabindex="-1"></a></span>
<span id="cb75-10"><a href="Chapter3.html#cb75-10" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">exp</span>((<span class="fl">0.8</span> <span class="sc">-</span> <span class="fl">0.08</span><span class="sc">*</span>age))<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>((<span class="fl">0.8</span> <span class="sc">-</span> <span class="fl">0.08</span><span class="sc">*</span>age)))</span>
<span id="cb75-11"><a href="Chapter3.html#cb75-11" tabindex="-1"></a></span>
<span id="cb75-12"><a href="Chapter3.html#cb75-12" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.8</span>),<span class="at">each=</span><span class="dv">5</span>)</span>
<span id="cb75-13"><a href="Chapter3.html#cb75-13" tabindex="-1"></a></span>
<span id="cb75-14"><a href="Chapter3.html#cb75-14" tabindex="-1"></a>num_inj <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb75-15"><a href="Chapter3.html#cb75-15" tabindex="-1"></a></span>
<span id="cb75-16"><a href="Chapter3.html#cb75-16" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb75-17"><a href="Chapter3.html#cb75-17" tabindex="-1"></a>  num_inj[i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span><span class="sc">-</span>p[i])<span class="sc">*</span><span class="fu">rbinom</span>(<span class="dv">1</span>, sum[i], <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">5.7</span> <span class="sc">+</span> <span class="fl">0.15</span><span class="sc">*</span>age[i] <span class="sc">+</span> r[i])<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">5.7</span> <span class="sc">+</span> <span class="fl">0.15</span><span class="sc">*</span>age[i] <span class="sc">+</span> r[i])))</span>
<span id="cb75-18"><a href="Chapter3.html#cb75-18" tabindex="-1"></a>}</span>
<span id="cb75-19"><a href="Chapter3.html#cb75-19" tabindex="-1"></a></span>
<span id="cb75-20"><a href="Chapter3.html#cb75-20" tabindex="-1"></a>dat_zibinom_glmm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">femaleID =</span> <span class="fu">as.factor</span>(femaleID),</span>
<span id="cb75-21"><a href="Chapter3.html#cb75-21" tabindex="-1"></a>                          <span class="at">age =</span> age,</span>
<span id="cb75-22"><a href="Chapter3.html#cb75-22" tabindex="-1"></a>           <span class="at">num_inj =</span> num_inj,</span>
<span id="cb75-23"><a href="Chapter3.html#cb75-23" tabindex="-1"></a>           <span class="at">sum =</span> sum)</span></code></pre></div>
<p>作成されたデータがこちら。</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="Chapter3.html#cb76-1" tabindex="-1"></a>dat_zibinom_glmm <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="Chapter3.html#cb76-2" tabindex="-1"></a>  <span class="fu">datatable</span>()</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-321cb281c643f12ff22c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-321cb281c643f12ff22c">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","728","729","730","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","750","751","752","753","754","755","756","757","758","759","760","761","762","763","764","765","766","767","768","769","770","771","772","773","774","775","776","777","778","779","780","781","782","783","784","785","786","787","788","789","790","791","792","793","794","795","796","797","798","799","800","801","802","803","804","805","806","807","808","809","810","811","812","813","814","815","816","817","818","819","820","821","822","823","824","825","826","827","828","829","830","831","832","833","834","835","836","837","838","839","840","841","842","843","844","845","846","847","848","849","850","851","852","853","854","855","856","857","858","859","860","861","862","863","864","865","866","867","868","869","870","871","872","873","874","875","876","877","878","879","880","881","882","883","884","885","886","887","888","889","890","891","892","893","894","895","896","897","898","899","900","901","902","903","904","905","906","907","908","909","910","911","912","913","914","915","916","917","918","919","920","921","922","923","924","925","926","927","928","929","930","931","932","933","934","935","936","937","938","939","940","941","942","943","944","945","946","947","948","949","950","951","952","953","954","955","956","957","958","959","960","961","962","963","964","965","966","967","968","969","970","971","972","973","974","975","976","977","978","979","980","981","982","983","984","985","986","987","988","989","990","991","992","993","994","995","996","997","998","999","1000"],["1","1","1","1","1","2","2","2","2","2","3","3","3","3","3","4","4","4","4","4","5","5","5","5","5","6","6","6","6","6","7","7","7","7","7","8","8","8","8","8","9","9","9","9","9","10","10","10","10","10","11","11","11","11","11","12","12","12","12","12","13","13","13","13","13","14","14","14","14","14","15","15","15","15","15","16","16","16","16","16","17","17","17","17","17","18","18","18","18","18","19","19","19","19","19","20","20","20","20","20","21","21","21","21","21","22","22","22","22","22","23","23","23","23","23","24","24","24","24","24","25","25","25","25","25","26","26","26","26","26","27","27","27","27","27","28","28","28","28","28","29","29","29","29","29","30","30","30","30","30","31","31","31","31","31","32","32","32","32","32","33","33","33","33","33","34","34","34","34","34","35","35","35","35","35","36","36","36","36","36","37","37","37","37","37","38","38","38","38","38","39","39","39","39","39","40","40","40","40","40","41","41","41","41","41","42","42","42","42","42","43","43","43","43","43","44","44","44","44","44","45","45","45","45","45","46","46","46","46","46","47","47","47","47","47","48","48","48","48","48","49","49","49","49","49","50","50","50","50","50","51","51","51","51","51","52","52","52","52","52","53","53","53","53","53","54","54","54","54","54","55","55","55","55","55","56","56","56","56","56","57","57","57","57","57","58","58","58","58","58","59","59","59","59","59","60","60","60","60","60","61","61","61","61","61","62","62","62","62","62","63","63","63","63","63","64","64","64","64","64","65","65","65","65","65","66","66","66","66","66","67","67","67","67","67","68","68","68","68","68","69","69","69","69","69","70","70","70","70","70","71","71","71","71","71","72","72","72","72","72","73","73","73","73","73","74","74","74","74","74","75","75","75","75","75","76","76","76","76","76","77","77","77","77","77","78","78","78","78","78","79","79","79","79","79","80","80","80","80","80","81","81","81","81","81","82","82","82","82","82","83","83","83","83","83","84","84","84","84","84","85","85","85","85","85","86","86","86","86","86","87","87","87","87","87","88","88","88","88","88","89","89","89","89","89","90","90","90","90","90","91","91","91","91","91","92","92","92","92","92","93","93","93","93","93","94","94","94","94","94","95","95","95","95","95","96","96","96","96","96","97","97","97","97","97","98","98","98","98","98","99","99","99","99","99","100","100","100","100","100","101","101","101","101","101","102","102","102","102","102","103","103","103","103","103","104","104","104","104","104","105","105","105","105","105","106","106","106","106","106","107","107","107","107","107","108","108","108","108","108","109","109","109","109","109","110","110","110","110","110","111","111","111","111","111","112","112","112","112","112","113","113","113","113","113","114","114","114","114","114","115","115","115","115","115","116","116","116","116","116","117","117","117","117","117","118","118","118","118","118","119","119","119","119","119","120","120","120","120","120","121","121","121","121","121","122","122","122","122","122","123","123","123","123","123","124","124","124","124","124","125","125","125","125","125","126","126","126","126","126","127","127","127","127","127","128","128","128","128","128","129","129","129","129","129","130","130","130","130","130","131","131","131","131","131","132","132","132","132","132","133","133","133","133","133","134","134","134","134","134","135","135","135","135","135","136","136","136","136","136","137","137","137","137","137","138","138","138","138","138","139","139","139","139","139","140","140","140","140","140","141","141","141","141","141","142","142","142","142","142","143","143","143","143","143","144","144","144","144","144","145","145","145","145","145","146","146","146","146","146","147","147","147","147","147","148","148","148","148","148","149","149","149","149","149","150","150","150","150","150","151","151","151","151","151","152","152","152","152","152","153","153","153","153","153","154","154","154","154","154","155","155","155","155","155","156","156","156","156","156","157","157","157","157","157","158","158","158","158","158","159","159","159","159","159","160","160","160","160","160","161","161","161","161","161","162","162","162","162","162","163","163","163","163","163","164","164","164","164","164","165","165","165","165","165","166","166","166","166","166","167","167","167","167","167","168","168","168","168","168","169","169","169","169","169","170","170","170","170","170","171","171","171","171","171","172","172","172","172","172","173","173","173","173","173","174","174","174","174","174","175","175","175","175","175","176","176","176","176","176","177","177","177","177","177","178","178","178","178","178","179","179","179","179","179","180","180","180","180","180","181","181","181","181","181","182","182","182","182","182","183","183","183","183","183","184","184","184","184","184","185","185","185","185","185","186","186","186","186","186","187","187","187","187","187","188","188","188","188","188","189","189","189","189","189","190","190","190","190","190","191","191","191","191","191","192","192","192","192","192","193","193","193","193","193","194","194","194","194","194","195","195","195","195","195","196","196","196","196","196","197","197","197","197","197","198","198","198","198","198","199","199","199","199","199","200","200","200","200","200"],[10.775269877151,10.775269877151,10.775269877151,10.775269877151,10.775269877151,15.9710023473873,15.9710023473873,15.9710023473873,15.9710023473873,15.9710023473873,18.7955441183907,18.7955441183907,18.7955441183907,18.7955441183907,18.7955441183907,6.79005804079728,6.79005804079728,6.79005804079728,6.79005804079728,6.79005804079728,16.5019364108387,16.5019364108387,16.5019364108387,16.5019364108387,16.5019364108387,16.7711956225515,16.7711956225515,16.7711956225515,16.7711956225515,16.7711956225515,12.9884101395287,12.9884101395287,12.9884101395287,12.9884101395287,12.9884101395287,13.0867885047553,13.0867885047553,13.0867885047553,13.0867885047553,13.0867885047553,13.0244180031735,13.0244180031735,13.0244180031735,13.0244180031735,13.0244180031735,11.8848675983456,11.8848675983456,11.8848675983456,11.8848675983456,11.8848675983456,13.3298255508626,13.3298255508626,13.3298255508626,13.3298255508626,13.3298255508626,11.505647442991,11.505647442991,11.505647442991,11.505647442991,11.505647442991,12.283111368767,12.283111368767,12.283111368767,12.283111368767,12.283111368767,15.2256058604669,15.2256058604669,15.2256058604669,15.2256058604669,15.2256058604669,18.3582292063977,18.3582292063977,18.3582292063977,18.3582292063977,18.3582292063977,14.6140007696323,14.6140007696323,14.6140007696323,14.6140007696323,14.6140007696323,13.2114667296768,13.2114667296768,13.2114667296768,13.2114667296768,13.2114667296768,11.8108160417957,11.8108160417957,11.8108160417957,11.8108160417957,11.8108160417957,12.0698991190587,12.0698991190587,12.0698991190587,12.0698991190587,12.0698991190587,23.4554231247127,23.4554231247127,23.4554231247127,23.4554231247127,23.4554231247127,15.4693087705321,15.4693087705321,15.4693087705321,15.4693087705321,15.4693087705321,13.2825993615817,13.2825993615817,13.2825993615817,13.2825993615817,13.2825993615817,13.4580824467637,13.4580824467637,13.4580824467637,13.4580824467637,13.4580824467637,16.6085630435205,16.6085630435205,16.6085630435205,16.6085630435205,16.6085630435205,12.5719791357188,12.5719791357188,12.5719791357188,12.5719791357188,12.5719791357188,9.93128281364735,9.93128281364735,9.93128281364735,9.93128281364735,9.93128281364735,17.0116450231525,17.0116450231525,17.0116450231525,17.0116450231525,17.0116450231525,11.4172049696264,11.4172049696264,11.4172049696264,11.4172049696264,11.4172049696264,14.9470159487254,14.9470159487254,14.9470159487254,14.9470159487254,14.9470159487254,11.7241798959106,11.7241798959106,11.7241798959106,11.7241798959106,11.7241798959106,18.8580414117009,18.8580414117009,18.8580414117009,18.8580414117009,18.8580414117009,13.3354242239583,13.3354242239583,13.3354242239583,13.3354242239583,13.3354242239583,12.5169598687062,12.5169598687062,12.5169598687062,12.5169598687062,12.5169598687062,13.2455967879183,13.2455967879183,13.2455967879183,13.2455967879183,13.2455967879183,9.29817285822454,9.29817285822454,9.29817285822454,9.29817285822454,9.29817285822454,10.9133325826703,10.9133325826703,10.9133325826703,10.9133325826703,10.9133325826703,7.36986122867964,7.36986122867964,7.36986122867964,7.36986122867964,7.36986122867964,10.3065238276499,10.3065238276499,10.3065238276499,10.3065238276499,10.3065238276499,13.969971494327,13.969971494327,13.969971494327,13.969971494327,13.969971494327,13.3693586085786,13.3693586085786,13.3693586085786,13.3693586085786,13.3693586085786,20.073236928505,20.073236928505,20.073236928505,20.073236928505,20.073236928505,11.259750467139,11.259750467139,11.259750467139,11.259750467139,11.259750467139,12.0062237819187,12.0062237819187,12.0062237819187,12.0062237819187,12.0062237819187,14.0178194931489,14.0178194931489,14.0178194931489,14.0178194931489,14.0178194931489,11.5198097329652,11.5198097329652,11.5198097329652,11.5198097329652,11.5198097329652,11.6101998874478,11.6101998874478,11.6101998874478,11.6101998874478,11.6101998874478,11.1243863257538,11.1243863257538,11.1243863257538,11.1243863257538,11.1243863257538,10.6180494002637,10.6180494002637,10.6180494002637,10.6180494002637,10.6180494002637,13.1666015835443,13.1666015835443,13.1666015835443,13.1666015835443,13.1666015835443,13.2610251495665,13.2610251495665,13.2610251495665,13.2610251495665,13.2610251495665,8.67889060119318,8.67889060119318,8.67889060119318,8.67889060119318,8.67889060119318,12.9627342635873,12.9627342635873,12.9627342635873,12.9627342635873,12.9627342635873,11.1188863145063,11.1188863145063,11.1188863145063,11.1188863145063,11.1188863145063,11.447632966778,11.447632966778,11.447632966778,11.447632966778,11.447632966778,14.4319166675511,14.4319166675511,14.4319166675511,14.4319166675511,14.4319166675511,16.9706953664808,16.9706953664808,16.9706953664808,16.9706953664808,16.9706953664808,20.7673611548527,20.7673611548527,20.7673611548527,20.7673611548527,20.7673611548527,12.2932630161971,12.2932630161971,12.2932630161971,12.2932630161971,12.2932630161971,20.6206837010005,20.6206837010005,20.6206837010005,20.6206837010005,20.6206837010005,10.9476700830696,10.9476700830696,10.9476700830696,10.9476700830696,10.9476700830696,17.2980596251648,17.2980596251648,17.2980596251648,17.2980596251648,17.2980596251648,23.9214687475125,23.9214687475125,23.9214687475125,23.9214687475125,23.9214687475125,14.8783386356866,14.8783386356866,14.8783386356866,14.8783386356866,14.8783386356866,12.6562824711831,12.6562824711831,12.6562824711831,12.6562824711831,12.6562824711831,14.9733833550116,14.9733833550116,14.9733833550116,14.9733833550116,14.9733833550116,21.219795568502,21.219795568502,21.219795568502,21.219795568502,21.219795568502,11.0148729213718,11.0148729213718,11.0148729213718,11.0148729213718,11.0148729213718,19.7873951279814,19.7873951279814,19.7873951279814,19.7873951279814,19.7873951279814,19.6534767677383,19.6534767677383,19.6534767677383,19.6534767677383,19.6534767677383,16.1776547902134,16.1776547902134,16.1776547902134,16.1776547902134,16.1776547902134,15.0241249345469,15.0241249345469,15.0241249345469,15.0241249345469,15.0241249345469,13.405859416435,13.405859416435,13.405859416435,13.405859416435,13.405859416435,13.7171662349412,13.7171662349412,13.7171662349412,13.7171662349412,13.7171662349412,17.269002986261,17.269002986261,17.269002986261,17.269002986261,17.269002986261,22.2459480146583,22.2459480146583,22.2459480146583,22.2459480146583,22.2459480146583,14.4631055563656,14.4631055563656,14.4631055563656,14.4631055563656,14.4631055563656,10.1325466865448,10.1325466865448,10.1325466865448,10.1325466865448,10.1325466865448,12.4674637801145,12.4674637801145,12.4674637801145,12.4674637801145,12.4674637801145,15.9039161675875,15.9039161675875,15.9039161675875,15.9039161675875,15.9039161675875,13.8902930976358,13.8902930976358,13.8902930976358,13.8902930976358,13.8902930976358,14.377735148175,14.377735148175,14.377735148175,14.377735148175,14.377735148175,14.4050207310091,14.4050207310091,14.4050207310091,14.4050207310091,14.4050207310091,10.1969433994316,10.1969433994316,10.1969433994316,10.1969433994316,10.1969433994316,14.3917449035509,14.3917449035509,14.3917449035509,14.3917449035509,14.3917449035509,17.9758128999266,17.9758128999266,17.9758128999266,17.9758128999266,17.9758128999266,17.4416304908389,17.4416304908389,17.4416304908389,17.4416304908389,17.4416304908389,16.9249907288189,16.9249907288189,16.9249907288189,16.9249907288189,16.9249907288189,13.5904380859333,13.5904380859333,13.5904380859333,13.5904380859333,13.5904380859333,14.3294218033253,14.3294218033253,14.3294218033253,14.3294218033253,14.3294218033253,10.8191524213912,10.8191524213912,10.8191524213912,10.8191524213912,10.8191524213912,14.8139441343984,14.8139441343984,14.8139441343984,14.8139441343984,14.8139441343984,15.8931860034854,15.8931860034854,15.8931860034854,15.8931860034854,15.8931860034854,20.9708740253403,20.9708740253403,20.9708740253403,20.9708740253403,20.9708740253403,18.5052963832721,18.5052963832721,18.5052963832721,18.5052963832721,18.5052963832721,13.2654579494949,13.2654579494949,13.2654579494949,13.2654579494949,13.2654579494949,16.2444260394991,16.2444260394991,16.2444260394991,16.2444260394991,16.2444260394991,11.0288718476315,11.0288718476315,11.0288718476315,11.0288718476315,11.0288718476315,18.073712694333,18.073712694333,18.073712694333,18.073712694333,18.073712694333,18.4052086368164,18.4052086368164,18.4052086368164,18.4052086368164,18.4052086368164,22.4239098688149,22.4239098688149,22.4239098688149,22.4239098688149,22.4239098688149,16.4508323703124,16.4508323703124,16.4508323703124,16.4508323703124,16.4508323703124,13.3384853426472,13.3384853426472,13.3384853426472,13.3384853426472,13.3384853426472,15.2309772279656,15.2309772279656,15.2309772279656,15.2309772279656,15.2309772279656,13.2413277616215,13.2413277616215,13.2413277616215,13.2413277616215,13.2413277616215,12.1090049450473,12.1090049450473,12.1090049450473,12.1090049450473,12.1090049450473,15.5844624791354,15.5844624791354,15.5844624791354,15.5844624791354,15.5844624791354,11.8630738081433,11.8630738081433,11.8630738081433,11.8630738081433,11.8630738081433,15.5886488567951,15.5886488567951,15.5886488567951,15.5886488567951,15.5886488567951,16.242388913552,16.242388913552,16.242388913552,16.242388913552,16.242388913552,14.817632090951,14.817632090951,14.817632090951,14.817632090951,14.817632090951,14.3142288344931,14.3142288344931,14.3142288344931,14.3142288344931,14.3142288344931,12.7282558693798,12.7282558693798,12.7282558693798,12.7282558693798,12.7282558693798,11.1158146901044,11.1158146901044,11.1158146901044,11.1158146901044,11.1158146901044,17.9724597092927,17.9724597092927,17.9724597092927,17.9724597092927,17.9724597092927,15.0782688412661,15.0782688412661,15.0782688412661,15.0782688412661,15.0782688412661,17.9089921605739,17.9089921605739,17.9089921605739,17.9089921605739,17.9089921605739,10.6449925202952,10.6449925202952,10.6449925202952,10.6449925202952,10.6449925202952,15.5915924481816,15.5915924481816,15.5915924481816,15.5915924481816,15.5915924481816,17.3560820743169,17.3560820743169,17.3560820743169,17.3560820743169,17.3560820743169,14.9080326824302,14.9080326824302,14.9080326824302,14.9080326824302,14.9080326824302,14.3301274100539,14.3301274100539,14.3301274100539,14.3301274100539,14.3301274100539,12.2633267365504,12.2633267365504,12.2633267365504,12.2633267365504,12.2633267365504,22.2035669571722,22.2035669571722,22.2035669571722,22.2035669571722,22.2035669571722,17.6267550860454,17.6267550860454,17.6267550860454,17.6267550860454,17.6267550860454,21.384729058324,21.384729058324,21.384729058324,21.384729058324,21.384729058324,15.280208743822,15.280208743822,15.280208743822,15.280208743822,15.280208743822,12.7900674536177,12.7900674536177,12.7900674536177,12.7900674536177,12.7900674536177,9.70349157988196,9.70349157988196,9.70349157988196,9.70349157988196,9.70349157988196,12.7736505912023,12.7736505912023,12.7736505912023,12.7736505912023,12.7736505912023,15.7920553637401,15.7920553637401,15.7920553637401,15.7920553637401,15.7920553637401,18.5479162161301,18.5479162161301,18.5479162161301,18.5479162161301,18.5479162161301,15.8846254727322,15.8846254727322,15.8846254727322,15.8846254727322,15.8846254727322,10.8981809050561,10.8981809050561,10.8981809050561,10.8981809050561,10.8981809050561,17.3405001498376,17.3405001498376,17.3405001498376,17.3405001498376,17.3405001498376,9.22464672804474,9.22464672804474,9.22464672804474,9.22464672804474,9.22464672804474,13.7195171313283,13.7195171313283,13.7195171313283,13.7195171313283,13.7195171313283,13.8935858490842,13.8935858490842,13.8935858490842,13.8935858490842,13.8935858490842,8.18113883437521,8.18113883437521,8.18113883437521,8.18113883437521,8.18113883437521,18.2202013283682,18.2202013283682,18.2202013283682,18.2202013283682,18.2202013283682,12.8199494179239,12.8199494179239,12.8199494179239,12.8199494179239,12.8199494179239,13.8308717250089,13.8308717250089,13.8308717250089,13.8308717250089,13.8308717250089,19.8830176238537,19.8830176238537,19.8830176238537,19.8830176238537,19.8830176238537,17.2283604386363,17.2283604386363,17.2283604386363,17.2283604386363,17.2283604386363,14.6204890605337,14.6204890605337,14.6204890605337,14.6204890605337,14.6204890605337,16.7981697244164,16.7981697244164,16.7981697244164,16.7981697244164,16.7981697244164,16.3974513254589,16.3974513254589,16.3974513254589,16.3974513254589,16.3974513254589,20.8199975660064,20.8199975660064,20.8199975660064,20.8199975660064,20.8199975660064,15.9656269125492,15.9656269125492,15.9656269125492,15.9656269125492,15.9656269125492,16.7719541812269,16.7719541812269,16.7719541812269,16.7719541812269,16.7719541812269,16.2164319125833,16.2164319125833,16.2164319125833,16.2164319125833,16.2164319125833,13.6796682337629,13.6796682337629,13.6796682337629,13.6796682337629,13.6796682337629,15.3416681208823,15.3416681208823,15.3416681208823,15.3416681208823,15.3416681208823,20.735606257926,20.735606257926,20.735606257926,20.735606257926,20.735606257926,11.9354263403365,11.9354263403365,11.9354263403365,11.9354263403365,11.9354263403365,15.4261599952437,15.4261599952437,15.4261599952437,15.4261599952437,15.4261599952437,19.7674573129574,19.7674573129574,19.7674573129574,19.7674573129574,19.7674573129574,14.1788261957705,14.1788261957705,14.1788261957705,14.1788261957705,14.1788261957705,11.3131601721992,11.3131601721992,11.3131601721992,11.3131601721992,11.3131601721992,11.9557573802743,11.9557573802743,11.9557573802743,11.9557573802743,11.9557573802743,13.6345553962353,13.6345553962353,13.6345553962353,13.6345553962353,13.6345553962353,12.0342747440465,12.0342747440465,12.0342747440465,12.0342747440465,12.0342747440465,14.0877621276521,14.0877621276521,14.0877621276521,14.0877621276521,14.0877621276521,13.5495310278034,13.5495310278034,13.5495310278034,13.5495310278034,13.5495310278034,14.359322207982,14.359322207982,14.359322207982,14.359322207982,14.359322207982,16.424696342582,16.424696342582,16.424696342582,16.424696342582,16.424696342582,17.1862159487075,17.1862159487075,17.1862159487075,17.1862159487075,17.1862159487075,20.8737201029665,20.8737201029665,20.8737201029665,20.8737201029665,20.8737201029665,14.7595722125225,14.7595722125225,14.7595722125225,14.7595722125225,14.7595722125225,13.8770603056964,13.8770603056964,13.8770603056964,13.8770603056964,13.8770603056964,20.1485200096712,20.1485200096712,20.1485200096712,20.1485200096712,20.1485200096712,20.9651528923948,20.9651528923948,20.9651528923948,20.9651528923948,20.9651528923948,15.1513541314514,15.1513541314514,15.1513541314514,15.1513541314514,15.1513541314514,13.8356993830327,13.8356993830327,13.8356993830327,13.8356993830327,13.8356993830327,8.62217603852917,8.62217603852917,8.62217603852917,8.62217603852917,8.62217603852917,19.9394183956137,19.9394183956137,19.9394183956137,19.9394183956137,19.9394183956137,12.068461480731,12.068461480731,12.068461480731,12.068461480731,12.068461480731,11.0668302196164,11.0668302196164,11.0668302196164,11.0668302196164,11.0668302196164,25.6531806013335,25.6531806013335,25.6531806013335,25.6531806013335,25.6531806013335,15.8225745788773,15.8225745788773,15.8225745788773,15.8225745788773,15.8225745788773,14.8835948646034,14.8835948646034,14.8835948646034,14.8835948646034,14.8835948646034,5.43723166965469,5.43723166965469,5.43723166965469,5.43723166965469,5.43723166965469,14.6507329404534,14.6507329404534,14.6507329404534,14.6507329404534,14.6507329404534,18.4161110722284,18.4161110722284,18.4161110722284,18.4161110722284,18.4161110722284,16.4485412040788,16.4485412040788,16.4485412040788,16.4485412040788,16.4485412040788,18.1931275656354,18.1931275656354,18.1931275656354,18.1931275656354,18.1931275656354,21.9430627023953,21.9430627023953,21.9430627023953,21.9430627023953,21.9430627023953,19.0918797990477,19.0918797990477,19.0918797990477,19.0918797990477,19.0918797990477,13.2194204460467,13.2194204460467,13.2194204460467,13.2194204460467,13.2194204460467,17.4646306246293,17.4646306246293,17.4646306246293,17.4646306246293,17.4646306246293,14.3055430416227,14.3055430416227,14.3055430416227,14.3055430416227,14.3055430416227,13.116752238903,13.116752238903,13.116752238903,13.116752238903,13.116752238903,5.00484470743268,5.00484470743268,5.00484470743268,5.00484470743268,5.00484470743268,12.2362360170768,12.2362360170768,12.2362360170768,12.2362360170768,12.2362360170768,16.7073512230729,16.7073512230729,16.7073512230729,16.7073512230729,16.7073512230729,22.5881138883176,22.5881138883176,22.5881138883176,22.5881138883176,22.5881138883176,16.7524311499828,16.7524311499828,16.7524311499828,16.7524311499828,16.7524311499828,17.1707357128356,17.1707357128356,17.1707357128356,17.1707357128356,17.1707357128356,11.6193387645325,11.6193387645325,11.6193387645325,11.6193387645325,11.6193387645325,15.5692914784139,15.5692914784139,15.5692914784139,15.5692914784139,15.5692914784139,7.72616860339418,7.72616860339418,7.72616860339418,7.72616860339418,7.72616860339418],[0,0,0,0,0,0,0,6,0,6,4,6,4,4,0,0,1,0,0,0,3,3,3,9,0,13,0,0,0,9,2,0,0,0,0,2,0,4,1,1,0,0,0,0,0,0,0,0,3,1,1,0,1,3,3,0,0,0,0,1,0,1,0,0,0,3,0,0,0,0,17,0,21,21,0,1,4,0,6,5,1,0,0,3,1,2,0,0,1,0,1,0,0,1,2,13,0,19,8,7,0,4,1,1,2,0,0,0,0,0,0,0,0,2,1,6,5,3,0,5,5,2,0,3,4,0,0,1,0,0,3,0,0,4,4,6,2,1,4,3,2,4,0,2,3,0,0,0,0,1,5,8,4,0,0,0,5,0,14,8,0,2,3,5,0,1,0,0,0,3,1,1,0,0,0,0,4,1,0,0,0,1,0,0,1,0,3,2,0,5,2,3,1,0,1,0,1,1,2,1,2,5,0,7,1,2,3,1,0,0,3,4,3,2,5,3,5,3,2,0,2,0,0,0,0,0,1,2,0,0,0,0,0,0,5,0,1,2,0,0,0,0,2,0,2,0,0,13,13,9,0,0,0,2,0,0,0,1,4,2,0,0,0,0,0,0,0,0,0,0,1,5,0,0,2,1,2,3,2,1,0,9,10,5,6,0,0,0,0,2,0,3,11,0,3,0,0,1,0,0,18,21,0,0,0,0,26,0,28,0,0,3,5,0,5,0,0,2,1,2,0,0,0,0,0,13,16,25,16,12,4,1,0,0,0,30,26,0,0,23,6,0,0,0,5,0,4,10,9,2,2,3,3,0,0,0,4,0,0,5,3,0,6,5,0,5,0,1,0,3,8,7,3,7,5,0,1,0,0,1,0,0,1,0,0,0,0,1,0,1,2,7,4,0,0,1,0,0,1,3,10,0,6,2,0,6,0,0,0,0,0,1,0,0,0,3,1,0,0,0,11,13,16,0,16,4,0,3,5,0,5,0,0,0,2,1,2,1,0,0,6,0,4,3,5,0,1,0,0,0,0,0,0,1,1,1,1,1,0,0,5,4,2,6,3,0,0,2,2,0,0,0,0,0,3,0,0,0,1,0,13,11,7,0,10,4,0,0,4,0,6,0,1,0,6,0,3,0,2,1,7,0,9,3,0,0,0,0,0,2,5,3,1,2,0,0,0,1,0,0,3,0,0,9,0,3,2,4,0,3,3,3,2,0,1,0,0,1,0,0,3,2,0,3,3,0,2,2,0,7,2,0,0,0,0,0,0,2,0,0,0,0,11,10,0,0,10,9,0,13,0,3,4,0,4,3,1,3,2,0,1,0,0,2,4,0,0,1,0,8,0,5,0,0,0,0,1,3,1,1,0,3,2,0,1,7,3,4,3,5,0,4,5,2,0,1,4,3,0,3,0,4,4,2,6,5,9,11,10,12,3,7,0,5,0,0,1,1,5,0,4,1,2,3,0,3,3,0,3,2,0,10,0,0,7,0,0,0,0,0,1,0,0,0,0,2,0,0,3,2,0,0,0,0,0,0,0,0,0,2,0,10,6,7,11,0,0,0,0,0,11,0,0,7,0,2,0,0,0,0,0,0,1,0,0,1,1,3,1,3,3,3,1,7,0,10,12,0,0,8,2,4,1,0,0,2,5,4,0,0,5,10,5,7,3,0,0,0,7,0,3,0,6,0,0,0,0,7,4,0,3,0,0,0,3,1,1,9,0,7,0,9,0,0,0,0,0,1,2,0,4,5,0,7,0,1,3,5,4,1,0,0,2,0,0,1,0,1,0,0,8,13,0,0,11,4,7,4,4,0,0,0,4,0,4,0,0,1,0,0,1,0,0,0,3,0,6,11,4,0,0,5,5,7,6,0,0,0,1,1,29,0,22,0,0,0,1,2,3,1,2,0,3,0,0,6,4,0,0,4,0,26,22,0,25,0,0,1,1,0,0,0,2,4,0,0,2,5,4,0,3,14,8,9,0,0,1,0,1,1,0,0,0,1,0,0,22,18,25,23,0,1,1,1,0,0,0,3,0,1,1,0,0,0,0,0,0,2,0,3,16,0,14,14,10,0,1,0,2,0,0,7,3,8,4,24,25,19,20,21,9,0,0,3,5,6,4,3,0,4,6,0,2,3,0,4,5,4,0,4,1,5,3,0,1,0,0,0,0,0,3,4,0,0,0,7,6,9,3,0,7,0,17,11,12,7,0,0,8,9,3,0,0,1,2,0,0,0,0,0,0,1,0,2,0,0,0,0,0,0],[104,104,104,104,104,106,106,106,106,106,101,101,101,101,101,107,107,107,107,107,103,103,103,103,103,107,107,107,107,107,118,118,118,118,118,111,111,111,111,111,100,100,100,100,100,88,88,88,88,88,113,113,113,113,113,87,87,87,87,87,83,83,83,83,83,94,94,94,94,94,98,98,98,98,98,93,93,93,93,93,115,115,115,115,115,102,102,102,102,102,111,111,111,111,111,100,100,100,100,100,101,101,101,101,101,103,103,103,103,103,81,81,81,81,81,129,129,129,129,129,106,106,106,106,106,93,93,93,93,93,83,83,83,83,83,97,97,97,97,97,91,91,91,91,91,103,103,103,103,103,120,120,120,120,120,99,99,99,99,99,89,89,89,89,89,104,104,104,104,104,89,89,89,89,89,105,105,105,105,105,89,89,89,89,89,113,113,113,113,113,104,104,104,104,104,102,102,102,102,102,102,102,102,102,102,104,104,104,104,104,110,110,110,110,110,104,104,104,104,104,106,106,106,106,106,88,88,88,88,88,116,116,116,116,116,102,102,102,102,102,107,107,107,107,107,86,86,86,86,86,109,109,109,109,109,96,96,96,96,96,108,108,108,108,108,82,82,82,82,82,93,93,93,93,93,108,108,108,108,108,125,125,125,125,125,104,104,104,104,104,100,100,100,100,100,102,102,102,102,102,92,92,92,92,92,109,109,109,109,109,120,120,120,120,120,93,93,93,93,93,90,90,90,90,90,99,99,99,99,99,103,103,103,103,103,89,89,89,89,89,111,111,111,111,111,110,110,110,110,110,102,102,102,102,102,84,84,84,84,84,91,91,91,91,91,97,97,97,97,97,101,101,101,101,101,109,109,109,109,109,101,101,101,101,101,82,82,82,82,82,119,119,119,119,119,102,102,102,102,102,111,111,111,111,111,102,102,102,102,102,104,104,104,104,104,105,105,105,105,105,88,88,88,88,88,90,90,90,90,90,97,97,97,97,97,100,100,100,100,100,93,93,93,93,93,85,85,85,85,85,95,95,95,95,95,99,99,99,99,99,83,83,83,83,83,95,95,95,95,95,116,116,116,116,116,102,102,102,102,102,102,102,102,102,102,101,101,101,101,101,109,109,109,109,109,110,110,110,110,110,95,95,95,95,95,100,100,100,100,100,94,94,94,94,94,111,111,111,111,111,108,108,108,108,108,104,104,104,104,104,98,98,98,98,98,100,100,100,100,100,81,81,81,81,81,102,102,102,102,102,108,108,108,108,108,94,94,94,94,94,94,94,94,94,94,88,88,88,88,88,93,93,93,93,93,97,97,97,97,97,116,116,116,116,116,87,87,87,87,87,109,109,109,109,109,111,111,111,111,111,101,101,101,101,101,111,111,111,111,111,92,92,92,92,92,86,86,86,86,86,94,94,94,94,94,102,102,102,102,102,99,99,99,99,99,88,88,88,88,88,84,84,84,84,84,119,119,119,119,119,88,88,88,88,88,98,98,98,98,98,119,119,119,119,119,109,109,109,109,109,119,119,119,119,119,99,99,99,99,99,98,98,98,98,98,94,94,94,94,94,77,77,77,77,77,103,103,103,103,103,99,99,99,99,99,122,122,122,122,122,93,93,93,93,93,126,126,126,126,126,106,106,106,106,106,109,109,109,109,109,112,112,112,112,112,113,113,113,113,113,102,102,102,102,102,103,103,103,103,103,101,101,101,101,101,102,102,102,102,102,101,101,101,101,101,94,94,94,94,94,109,109,109,109,109,103,103,103,103,103,84,84,84,84,84,96,96,96,96,96,121,121,121,121,121,81,81,81,81,81,107,107,107,107,107,104,104,104,104,104,105,105,105,105,105,100,100,100,100,100,90,90,90,90,90,111,111,111,111,111,94,94,94,94,94,91,91,91,91,91,97,97,97,97,97,114,114,114,114,114,88,88,88,88,88,108,108,108,108,108,98,98,98,98,98,96,96,96,96,96,92,92,92,92,92,97,97,97,97,97,94,94,94,94,94,115,115,115,115,115,104,104,104,104,104,91,91,91,91,91,87,87,87,87,87,91,91,91,91,91,101,101,101,101,101,106,106,106,106,106,101,101,101,101,101,115,115,115,115,115,101,101,101,101,101,87,87,87,87,87,117,117,117,117,117,97,97,97,97,97,91,91,91,91,91,120,120,120,120,120,100,100,100,100,100,113,113,113,113,113,94,94,94,94,94,87,87,87,87,87,101,101,101,101,101,93,93,93,93,93,101,101,101,101,101,90,90,90,90,90]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>femaleID<\/th>\n      <th>age<\/th>\n      <th>num_inj<\/th>\n      <th>sum<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><br/></p>
<p>サルの年齢(<code>age</code>)と攻撃の直後に怪我が確認された割合(<code>num_inj</code>/<code>sum</code>)をプロットしたところ、以下のようになった。年齢が高くなるほど、怪我が確認された割合が多くなるように見える。</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="Chapter3.html#cb77-1" tabindex="-1"></a>dat_zibinom_glmm <span class="sc">%&gt;%</span> </span>
<span id="cb77-2"><a href="Chapter3.html#cb77-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> num_inj<span class="sc">/</span>sum))<span class="sc">+</span></span>
<span id="cb77-3"><a href="Chapter3.html#cb77-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb77-4"><a href="Chapter3.html#cb77-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb77-5"><a href="Chapter3.html#cb77-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span> <span class="fl">0.8</span>,</span>
<span id="cb77-6"><a href="Chapter3.html#cb77-6" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>,</span>
<span id="cb77-7"><a href="Chapter3.html#cb77-7" tabindex="-1"></a>                                    <span class="at">vjust=</span><span class="fl">0.5</span>,</span>
<span id="cb77-8"><a href="Chapter3.html#cb77-8" tabindex="-1"></a>                                    <span class="at">size =</span> <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb77-9"><a href="Chapter3.html#cb77-9" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.35</span>))<span class="sc">+</span></span>
<span id="cb77-10"><a href="Chapter3.html#cb77-10" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.35</span>,<span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb77-11"><a href="Chapter3.html#cb77-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;怪</span><span class="sc">\n</span><span class="st">我</span><span class="sc">\n</span><span class="st">が</span><span class="sc">\n</span><span class="st">確</span><span class="sc">\n</span><span class="st">認</span><span class="sc">\n</span><span class="st">さ</span><span class="sc">\n</span><span class="st">れ</span><span class="sc">\n</span><span class="st">た</span><span class="sc">\n</span><span class="st">割</span><span class="sc">\n</span><span class="st">合&quot;</span>)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-61-1.png" width="432" style="display: block; margin: auto;" /></p>
<div id="普通のglmmを適用する" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> 普通のGLMMを適用する<a href="Chapter3.html#普通のglmmを適用する" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>そこで、以下のようなGLMMを考え、年齢が怪我が確認された割合に影響するかを調べる。</p>
<ul>
<li>分布: 二項分布<br />
</li>
<li>リンク関数: logit関数<br />
</li>
<li>応答変数: 怪我が確認された割合(<code>num_inj</code>/<code>sum</code>)<br />
</li>
<li>説明変数: 年齢(<code>age</code>)<br />
</li>
<li>ランダム切片: メスID</li>
</ul>
<p>数式で表すと以下のようになる。ただし、<span class="math inline">\(i\)</span>は各データポイントのIDを示す。例えば、<span class="math inline">\(age_i\)</span>は、<span class="math inline">\(i\)</span>番目の個体の年齢を表す。ただし、<span class="math inline">\(i = 1,2,3,...,1000\)</span>である。</p>
<p>なお、<span class="math inline">\(r_j \sim Normal(0, \sigma_j)\)</span>は<span class="math inline">\(r_{femaleID_i}\)</span>が平均0、分散<span class="math inline">\(\sigma^2\)</span>の正規分布に従って得られることを示す。</p>
<p><span class="math display">\[
\begin{aligned}
r_{femaleID_i} &amp;\sim Normal(0, \sigma^2) \\
logit(p_i) &amp;= log(\frac{p_i}{1-p_i}) = \beta_0 + \beta_{1} \times age_i + r_{femaleID_i}\\
num\_inj_i &amp;\sim Binomial(trials_i, p_i)
\end{aligned}
\]</span></p>
<p>Rでは以下のように実行する。</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="Chapter3.html#cb78-1" tabindex="-1"></a>r_binom_glmm <span class="ot">&lt;-</span> <span class="fu">glmer</span>(<span class="at">data =</span> dat_zibinom_glmm,</span>
<span id="cb78-2"><a href="Chapter3.html#cb78-2" tabindex="-1"></a>              <span class="fu">cbind</span>(num_inj, sum<span class="sc">-</span>num_inj) <span class="sc">~</span> age <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>femaleID),</span>
<span id="cb78-3"><a href="Chapter3.html#cb78-3" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link=</span><span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<p>結果は以下のようになり、<span class="math inline">\(\beta_0\)</span>の推定値は-7.400、<span class="math inline">\(\beta_1\)</span>の推定値は0.215、<span class="math inline">\(\sigma\)</span>の推定値は0.888である。</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="Chapter3.html#cb79-1" tabindex="-1"></a><span class="fu">summary</span>(r_binom_glmm)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: cbind(num_inj, sum - num_inj) ~ age + (1 | femaleID)
##    Data: dat_zibinom_glmm
## 
##      AIC      BIC   logLik deviance df.resid 
##   4850.3   4865.1  -2422.2   4844.3      997 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -4.5524 -0.9588 -0.4845  0.8565  6.3539 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  femaleID (Intercept) 0.7879   0.8876  
## Number of obs: 1000, groups:  femaleID, 200
## 
## Fixed effects:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -7.39994    0.31328  -23.62   &lt;2e-16 ***
## age          0.21545    0.01998   10.78   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##     (Intr)
## age -0.974</code></pre>
<p>つまり、<span class="math inline">\(r_{femaleID_i}\)</span>は平均0、標準偏差0.888の正規分布から得られ、怪我が確認される回数は試行数10、<span class="math inline">\(\frac{p_i}{1-p_i} = e^{-7.40 + 0.216 \times age_i + r_{femaleID_i}}\)</span>となる二項分布から得られると推定される。</p>
<p>そこで、推定したパラメータを持つモデルの下で得られるデータをシミュレートし(<code>num_inj_sim_glmm</code>)、それを実際に得られたデータと比較してみる。</p>
<p>下の図からわかるように、実際に得られたデータから算出された怪我が観察された割合(<code>prop_inj</code>)では、<strong>推定されたモデルからシミュレートされたデータ</strong>(<code>prop_inj_sim_glmm</code>)<strong>より0が多い</strong>(= ゼロ過剰が生じている)。GLMの場合と同様に<u>怪我がをしていても体毛に隠れていて気づかない場合があったなど、0が増えてしまう何らかのメカニズムがあったと推測される</u>。</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="Chapter3.html#cb81-1" tabindex="-1"></a><span class="do">## モデルの下で得られるデータをシミュレート  </span></span>
<span id="cb81-2"><a href="Chapter3.html#cb81-2" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>(<span class="fu">fixef</span>(r_binom_glmm)[[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">fixef</span>(r_binom_glmm)[[<span class="dv">2</span>]]<span class="sc">*</span>dat_zibinom_glmm<span class="sc">$</span>age <span class="sc">+</span> <span class="fu">rep</span>(<span class="fu">ranef</span>(r_binom_glmm)<span class="sc">$</span>femaleID<span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>,<span class="at">each =</span> <span class="dv">5</span>))))</span>
<span id="cb81-3"><a href="Chapter3.html#cb81-3" tabindex="-1"></a></span>
<span id="cb81-4"><a href="Chapter3.html#cb81-4" tabindex="-1"></a>num_inj_sim_glmm <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, dat_zibinom_glmm<span class="sc">$</span>sum, p)</span>
<span id="cb81-5"><a href="Chapter3.html#cb81-5" tabindex="-1"></a>prop_inj_sim_glmm <span class="ot">&lt;-</span> num_inj_sim_glmm<span class="sc">/</span>dat_zibinom_glmm<span class="sc">$</span>sum</span>
<span id="cb81-6"><a href="Chapter3.html#cb81-6" tabindex="-1"></a></span>
<span id="cb81-7"><a href="Chapter3.html#cb81-7" tabindex="-1"></a><span class="do">## 実際のデータと比較  </span></span>
<span id="cb81-8"><a href="Chapter3.html#cb81-8" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">prop_inj =</span> num_inj<span class="sc">/</span>dat_zibinom_glmm<span class="sc">$</span>sum,</span>
<span id="cb81-9"><a href="Chapter3.html#cb81-9" tabindex="-1"></a>           <span class="at">prop_inj_sim_glmm =</span> prop_inj_sim_glmm) <span class="sc">%&gt;%</span></span>
<span id="cb81-10"><a href="Chapter3.html#cb81-10" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-11"><a href="Chapter3.html#cb81-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value))<span class="sc">+</span></span>
<span id="cb81-12"><a href="Chapter3.html#cb81-12" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">fill =</span> name),</span>
<span id="cb81-13"><a href="Chapter3.html#cb81-13" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb81-14"><a href="Chapter3.html#cb81-14" tabindex="-1"></a>                 <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb81-15"><a href="Chapter3.html#cb81-15" tabindex="-1"></a>                 <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.2</span>,<span class="at">by=</span><span class="fl">0.01</span>))<span class="sc">+</span></span>
<span id="cb81-16"><a href="Chapter3.html#cb81-16" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">13</span>)<span class="sc">+</span></span>
<span id="cb81-17"><a href="Chapter3.html#cb81-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.8</span>,</span>
<span id="cb81-18"><a href="Chapter3.html#cb81-18" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>,<span class="at">vjust=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb81-19"><a href="Chapter3.html#cb81-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;怪我が確認された割合&quot;</span>,</span>
<span id="cb81-20"><a href="Chapter3.html#cb81-20" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;度</span><span class="sc">\n</span><span class="st">数&quot;</span>)<span class="sc">+</span></span>
<span id="cb81-21"><a href="Chapter3.html#cb81-21" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.13</span>))<span class="sc">+</span></span>
<span id="cb81-22"><a href="Chapter3.html#cb81-22" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>,<span class="st">&quot;black&quot;</span>))  <span class="ot">-&gt;</span> p_binom_hist</span>
<span id="cb81-23"><a href="Chapter3.html#cb81-23" tabindex="-1"></a></span>
<span id="cb81-24"><a href="Chapter3.html#cb81-24" tabindex="-1"></a>p_binom_hist</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-64-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>検定をすると、ゼロ過剰が検出される。</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="Chapter3.html#cb82-1" tabindex="-1"></a><span class="fu">testZeroInflation</span>(r_binom_glmm)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-65-1.png" width="432" style="display: block; margin: auto;" /></p>
<pre><code>## 
##  DHARMa zero-inflation test via comparison to expected zeros with
##  simulation under H0 = fitted model
## 
## data:  simulationOutput
## ratioObsSim = 1.6004, p-value &lt; 2.2e-16
## alternative hypothesis: two.sided</code></pre>
<p>dispersion parameterを算出すると、二項分布での規定値(= 1)を越えており、過分散が生じていることが分かる。おそらくゼロ過剰が原因だろう。</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="Chapter3.html#cb84-1" tabindex="-1"></a>resid_binom_glmm <span class="ot">&lt;-</span><span class="fu">simulateResiduals</span>(r_binom_glmm)</span>
<span id="cb84-2"><a href="Chapter3.html#cb84-2" tabindex="-1"></a></span>
<span id="cb84-3"><a href="Chapter3.html#cb84-3" tabindex="-1"></a><span class="fu">check_overdispersion</span>(r_binom_glmm)</span></code></pre></div>
<pre><code>## # Overdispersion test
## 
##        dispersion ratio =    2.230
##   Pearson&#39;s Chi-Squared = 2223.035
##                 p-value =  &lt; 0.001</code></pre>
<p>QQplotをみても、データがモデルによく当てはまっていないことが分かる。</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="Chapter3.html#cb86-1" tabindex="-1"></a><span class="fu">plotQQunif</span>(resid_binom_glmm)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-67-1.png" width="432" style="display: block; margin: auto;" /></p>
</div>
<div id="ゼロ過剰二項モデル" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> ゼロ過剰二項モデル<a href="Chapter3.html#ゼロ過剰二項モデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>そこで、ゼロ過剰モデルを考える。<br />
数式で表すと以下のようになる。ただし、<span class="math inline">\(i\)</span>は各データポイントのIDを示す。例えば、<span class="math inline">\(age_i\)</span>は、<span class="math inline">\(i\)</span>番目の個体の年齢を表す。ただし、<span class="math inline">\(i = 1,2,3,...,1000\)</span>である。</p>
<p>なお、今回は<span class="math inline">\(q_i\)</span>は年齢によって変化するが、メスのIDによるばらつきはないとする(メスIDによるばらつきを仮定することもできる)。</p>
<p><span class="math display">\[
\begin{aligned}
r_{femaleID_i} &amp;\sim Normal(0, \sigma^2) \\
logit(q_i) &amp;= log(\frac{q_i}{1-q_i}) = \beta_{10} + \beta_{11} \times age_i\\
logit(p_i) &amp;= log(\frac{p_i}{1-p_i}) = \beta_{20} + \beta_{21} \times age_i + r_{femaleID_i}\\
num\_inj_i &amp;\sim ZIBinomial(q_i, trials_i, p_i)
\end{aligned}
\]</span></p>
<p>Rでは以下のコードで実行できる。</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="Chapter3.html#cb87-1" tabindex="-1"></a>r_zibinom_glmm <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(<span class="at">data =</span> dat_zibinom_glmm,</span>
<span id="cb87-2"><a href="Chapter3.html#cb87-2" tabindex="-1"></a>  <span class="fu">cbind</span>(num_inj, sum <span class="sc">-</span> num_inj) <span class="sc">~</span> age <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>femaleID),</span>
<span id="cb87-3"><a href="Chapter3.html#cb87-3" tabindex="-1"></a>  <span class="do">## 年齢によらないとする場合はziformula~1,</span></span>
<span id="cb87-4"><a href="Chapter3.html#cb87-4" tabindex="-1"></a>  <span class="do">## メスIDによるばらつきを仮定する場合はziformula ~ age + (1|femaleID)</span></span>
<span id="cb87-5"><a href="Chapter3.html#cb87-5" tabindex="-1"></a>                    <span class="at">ziformula =</span> <span class="sc">~</span>age,</span>
<span id="cb87-6"><a href="Chapter3.html#cb87-6" tabindex="-1"></a>                    <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span></code></pre></div>
<p>モデルで推定されたパラメータは以下のようになる。</p>
<p><code>Zero-inflation model:</code>というところにある推定結果が<span class="math inline">\(q_i\)</span>に関するパラメータの推定値であり、<span class="math inline">\(\beta_{10}\)</span>と<span class="math inline">\(\beta_{11}\)</span>の推定値はそれぞれ0.547、-0.070となる。</p>
<p><code>Conditional model:</code>というところにある推定結果が<span class="math inline">\(p_i\)</span>に関するパラメータの推定値であり、<span class="math inline">\(\beta_{20}\)</span>と<span class="math inline">\(\beta_{21}\)</span>の推定値はそれぞれ-6.489、0.192となる。</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="Chapter3.html#cb88-1" tabindex="-1"></a><span class="fu">summary</span>(r_zibinom_glmm)</span></code></pre></div>
<pre><code>##  Family: binomial  ( logit )
## Formula:          cbind(num_inj, sum - num_inj) ~ age + (1 | femaleID)
## Zero inflation:                                 ~age
## Data: dat_zibinom_glmm
## 
##      AIC      BIC   logLik deviance df.resid 
##   3554.4   3578.9  -1772.2   3544.4      995 
## 
## Random effects:
## 
## Conditional model:
##  Groups   Name        Variance Std.Dev.
##  femaleID (Intercept) 0.6874   0.8291  
## Number of obs: 1000, groups:  femaleID, 200
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -6.4889     0.3340 -19.426   &lt;2e-16 ***
## age           0.1921     0.0206   9.327   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Zero-inflation model:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  0.54743    0.41181   1.329  0.18374   
## age         -0.06958    0.02534  -2.746  0.00604 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>推定したパラメータを持つゼロ過剰二項モデルの下で得られるデータをシミュレートし(<code>num_inj_zisim_glmm</code>)、それを実際に得られたデータと比較してみる。</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="Chapter3.html#cb90-1" tabindex="-1"></a><span class="do">## 推定されたパラメータからデータをシミュレート</span></span>
<span id="cb90-2"><a href="Chapter3.html#cb90-2" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>(<span class="fu">fixef</span>(r_zibinom_glmm)[[<span class="dv">2</span>]][[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">fixef</span>(r_zibinom_glmm)[[<span class="dv">2</span>]][[<span class="dv">2</span>]]<span class="sc">*</span>dat_zibinom_glmm<span class="sc">$</span>age)))</span>
<span id="cb90-3"><a href="Chapter3.html#cb90-3" tabindex="-1"></a></span>
<span id="cb90-4"><a href="Chapter3.html#cb90-4" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>(<span class="fu">fixef</span>(r_zibinom_glmm)[[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">fixef</span>(r_zibinom_glmm)[[<span class="dv">1</span>]][[<span class="dv">2</span>]]<span class="sc">*</span>dat_zibinom_glmm<span class="sc">$</span>age <span class="sc">+</span>  <span class="fu">rep</span>(<span class="fu">as.vector</span>(<span class="fu">ranef</span>(r_binom_glmm))<span class="sc">$</span>femaleID<span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>,<span class="dv">5</span>))))</span>
<span id="cb90-5"><a href="Chapter3.html#cb90-5" tabindex="-1"></a></span>
<span id="cb90-6"><a href="Chapter3.html#cb90-6" tabindex="-1"></a>num_inj_zisim_glmm <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="dv">1</span>,<span class="dv">1</span><span class="sc">-</span>q)<span class="sc">*</span><span class="fu">rbinom</span>(N,dat_zibinom_glmm<span class="sc">$</span>sum, p)</span>
<span id="cb90-7"><a href="Chapter3.html#cb90-7" tabindex="-1"></a></span>
<span id="cb90-8"><a href="Chapter3.html#cb90-8" tabindex="-1"></a>prop_inj_zisim_glmm <span class="ot">&lt;-</span> num_inj_zisim_glmm<span class="sc">/</span>dat_zibinom_glmm<span class="sc">$</span>sum</span></code></pre></div>
<p>下の図からわかるように、推定されたモデルからシミュレートされたデータから算出した怪我が観察された割合(<code>prop_inj_zisim_glmm</code>)の分布は、さきほどより実際のデータとよくマッチしていることが分かる。</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="Chapter3.html#cb91-1" tabindex="-1"></a><span class="do">## 実際のデータと比較  </span></span>
<span id="cb91-2"><a href="Chapter3.html#cb91-2" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">prop_inj =</span> dat_zibinom_glmm<span class="sc">$</span>num_inj<span class="sc">/</span>dat_zibinom_glmm<span class="sc">$</span>sum,</span>
<span id="cb91-3"><a href="Chapter3.html#cb91-3" tabindex="-1"></a>           <span class="at">prop_inj_zisim_glmm =</span> prop_inj_zisim_glmm) <span class="sc">%&gt;%</span></span>
<span id="cb91-4"><a href="Chapter3.html#cb91-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb91-5"><a href="Chapter3.html#cb91-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value))<span class="sc">+</span></span>
<span id="cb91-6"><a href="Chapter3.html#cb91-6" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">fill =</span> name),</span>
<span id="cb91-7"><a href="Chapter3.html#cb91-7" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb91-8"><a href="Chapter3.html#cb91-8" tabindex="-1"></a>                 <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb91-9"><a href="Chapter3.html#cb91-9" tabindex="-1"></a>                 <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.13</span>,<span class="fl">0.01</span>))<span class="sc">+</span></span>
<span id="cb91-10"><a href="Chapter3.html#cb91-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">13</span>)<span class="sc">+</span></span>
<span id="cb91-11"><a href="Chapter3.html#cb91-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="fl">0.8</span>,</span>
<span id="cb91-12"><a href="Chapter3.html#cb91-12" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>,<span class="at">vjust=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb91-13"><a href="Chapter3.html#cb91-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;怪我が確認された割合&quot;</span>,</span>
<span id="cb91-14"><a href="Chapter3.html#cb91-14" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;度</span><span class="sc">\n</span><span class="st">数&quot;</span>)<span class="sc">+</span></span>
<span id="cb91-15"><a href="Chapter3.html#cb91-15" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>,<span class="st">&quot;red3&quot;</span>)) <span class="ot">-&gt;</span> p_zibinom_glmm_hist</span>
<span id="cb91-16"><a href="Chapter3.html#cb91-16" tabindex="-1"></a></span>
<span id="cb91-17"><a href="Chapter3.html#cb91-17" tabindex="-1"></a>p_zibinom_glmm_hist</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-71-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>検定をしても、ゼロ過剰は検出されない。</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="Chapter3.html#cb92-1" tabindex="-1"></a><span class="fu">testZeroInflation</span>(r_zibinom_glmm)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-72-1.png" width="432" style="display: block; margin: auto;" /></p>
<pre><code>## 
##  DHARMa zero-inflation test via comparison to expected zeros with
##  simulation under H0 = fitted model
## 
## data:  simulationOutput
## ratioObsSim = 0.99666, p-value = 0.952
## alternative hypothesis: two.sided</code></pre>
<p>検定を行っても過分散が検出されない。</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="Chapter3.html#cb94-1" tabindex="-1"></a>resid_zibinom_glmm <span class="ot">&lt;-</span><span class="fu">simulateResiduals</span>(r_zibinom_glmm)</span>
<span id="cb94-2"><a href="Chapter3.html#cb94-2" tabindex="-1"></a></span>
<span id="cb94-3"><a href="Chapter3.html#cb94-3" tabindex="-1"></a><span class="fu">testDispersion</span>(resid_zibinom_glmm)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-73-1.png" width="432" style="display: block; margin: auto;" /></p>
<pre><code>## 
##  DHARMa nonparametric dispersion test via sd of residuals fitted vs.
##  simulated
## 
## data:  simulationOutput
## dispersion = 0.84408, p-value = 0.608
## alternative hypothesis: two.sided</code></pre>
<p>QQplotをみても、データがモデルによく当てはまっていることが分かる。</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="Chapter3.html#cb96-1" tabindex="-1"></a><span class="fu">plotQQunif</span>(resid_zibinom_glmm)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-74-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>推定されたモデルに基づく回帰曲線を描画する。<br />
確率<span class="math inline">\(q_i\)</span>で得られた0を含まないものと、含むものを両方描ける。</p>
<p><span class="math inline">\(q_i\)</span>で得られた0を<strong>含まない</strong>場合</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="Chapter3.html#cb97-1" tabindex="-1"></a>fit_zibinom_glmm_a <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(r_zibinom_glmm,</span>
<span id="cb97-2"><a href="Chapter3.html#cb97-2" tabindex="-1"></a>          <span class="do">## 温度は5~26で0.1刻み</span></span>
<span id="cb97-3"><a href="Chapter3.html#cb97-3" tabindex="-1"></a>          <span class="at">terms =</span> <span class="st">&quot;age[5:26,by=0.1]&quot;</span>,</span>
<span id="cb97-4"><a href="Chapter3.html#cb97-4" tabindex="-1"></a>          <span class="at">type =</span><span class="st">&quot;fixed&quot;</span>)</span>
<span id="cb97-5"><a href="Chapter3.html#cb97-5" tabindex="-1"></a></span>
<span id="cb97-6"><a href="Chapter3.html#cb97-6" tabindex="-1"></a><span class="fu">ggplot</span>(dat_zibinom_glmm)<span class="sc">+</span></span>
<span id="cb97-7"><a href="Chapter3.html#cb97-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> num_inj<span class="sc">/</span>sum),</span>
<span id="cb97-8"><a href="Chapter3.html#cb97-8" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb97-9"><a href="Chapter3.html#cb97-9" tabindex="-1"></a>  <span class="do">### 回帰曲線</span></span>
<span id="cb97-10"><a href="Chapter3.html#cb97-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fit_zibinom_glmm_a,</span>
<span id="cb97-11"><a href="Chapter3.html#cb97-11" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> predicted))<span class="sc">+</span></span>
<span id="cb97-12"><a href="Chapter3.html#cb97-12" tabindex="-1"></a>  <span class="do">## 95%信頼区間</span></span>
<span id="cb97-13"><a href="Chapter3.html#cb97-13" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> fit_zibinom_glmm_a,</span>
<span id="cb97-14"><a href="Chapter3.html#cb97-14" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> predicted,</span>
<span id="cb97-15"><a href="Chapter3.html#cb97-15" tabindex="-1"></a>                <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb97-16"><a href="Chapter3.html#cb97-16" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb97-17"><a href="Chapter3.html#cb97-17" tabindex="-1"></a>   <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)<span class="sc">+</span></span>
<span id="cb97-18"><a href="Chapter3.html#cb97-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span> <span class="fl">0.8</span>,</span>
<span id="cb97-19"><a href="Chapter3.html#cb97-19" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>,</span>
<span id="cb97-20"><a href="Chapter3.html#cb97-20" tabindex="-1"></a>                                    <span class="at">vjust=</span><span class="fl">0.5</span>,</span>
<span id="cb97-21"><a href="Chapter3.html#cb97-21" tabindex="-1"></a>                                    <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb97-22"><a href="Chapter3.html#cb97-22" tabindex="-1"></a>        <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>))<span class="sc">+</span></span>
<span id="cb97-23"><a href="Chapter3.html#cb97-23" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.35</span>))<span class="sc">+</span></span>
<span id="cb97-24"><a href="Chapter3.html#cb97-24" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.35</span>,<span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb97-25"><a href="Chapter3.html#cb97-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;ゼロ過剰二項モデル</span><span class="sc">\n</span><span class="st">(qによる0含まず)&quot;</span>,</span>
<span id="cb97-26"><a href="Chapter3.html#cb97-26" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;怪</span><span class="sc">\n</span><span class="st">我</span><span class="sc">\n</span><span class="st">が</span><span class="sc">\n</span><span class="st">確</span><span class="sc">\n</span><span class="st">認</span><span class="sc">\n</span><span class="st">さ</span><span class="sc">\n</span><span class="st">れ</span><span class="sc">\n</span><span class="st">た</span><span class="sc">\n</span><span class="st">割</span><span class="sc">\n</span><span class="st">合&quot;</span>)<span class="ot">-&gt;</span> p_zibinom_glmm_a</span></code></pre></div>
<p><span class="math inline">\(q_i\)</span>で得られた0を<strong>含む</strong>場合</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="Chapter3.html#cb98-1" tabindex="-1"></a>fit_zibinom_glmm_b <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(r_zibinom_glmm,</span>
<span id="cb98-2"><a href="Chapter3.html#cb98-2" tabindex="-1"></a>          <span class="do">## 温度は5~15で0.1刻み</span></span>
<span id="cb98-3"><a href="Chapter3.html#cb98-3" tabindex="-1"></a>          <span class="at">terms =</span> <span class="st">&quot;age[5:26,by=0.1]&quot;</span>,</span>
<span id="cb98-4"><a href="Chapter3.html#cb98-4" tabindex="-1"></a>          <span class="at">type =</span><span class="st">&quot;zero_inflated&quot;</span>)</span>
<span id="cb98-5"><a href="Chapter3.html#cb98-5" tabindex="-1"></a></span>
<span id="cb98-6"><a href="Chapter3.html#cb98-6" tabindex="-1"></a><span class="fu">ggplot</span>(dat_zibinom_glmm)<span class="sc">+</span></span>
<span id="cb98-7"><a href="Chapter3.html#cb98-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> num_inj<span class="sc">/</span>sum),</span>
<span id="cb98-8"><a href="Chapter3.html#cb98-8" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb98-9"><a href="Chapter3.html#cb98-9" tabindex="-1"></a>  <span class="do">### 回帰曲線</span></span>
<span id="cb98-10"><a href="Chapter3.html#cb98-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fit_zibinom_glmm_b,</span>
<span id="cb98-11"><a href="Chapter3.html#cb98-11" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> predicted))<span class="sc">+</span></span>
<span id="cb98-12"><a href="Chapter3.html#cb98-12" tabindex="-1"></a>  <span class="do">## 95%信頼区間</span></span>
<span id="cb98-13"><a href="Chapter3.html#cb98-13" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> fit_zibinom_glmm_b,</span>
<span id="cb98-14"><a href="Chapter3.html#cb98-14" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> predicted,</span>
<span id="cb98-15"><a href="Chapter3.html#cb98-15" tabindex="-1"></a>                <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb98-16"><a href="Chapter3.html#cb98-16" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb98-17"><a href="Chapter3.html#cb98-17" tabindex="-1"></a>   <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)<span class="sc">+</span></span>
<span id="cb98-18"><a href="Chapter3.html#cb98-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span> <span class="fl">0.8</span>,</span>
<span id="cb98-19"><a href="Chapter3.html#cb98-19" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>,</span>
<span id="cb98-20"><a href="Chapter3.html#cb98-20" tabindex="-1"></a>                                    <span class="at">vjust=</span><span class="fl">0.5</span>,</span>
<span id="cb98-21"><a href="Chapter3.html#cb98-21" tabindex="-1"></a>                                    <span class="at">size =</span><span class="dv">10</span>),</span>
<span id="cb98-22"><a href="Chapter3.html#cb98-22" tabindex="-1"></a>        <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>))<span class="sc">+</span></span>
<span id="cb98-23"><a href="Chapter3.html#cb98-23" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.35</span>))<span class="sc">+</span></span>
<span id="cb98-24"><a href="Chapter3.html#cb98-24" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.35</span>,<span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb98-25"><a href="Chapter3.html#cb98-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;ゼロ過剰二項モデル</span><span class="sc">\n</span><span class="st">(qによる0含む)&quot;</span>,</span>
<span id="cb98-26"><a href="Chapter3.html#cb98-26" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;怪</span><span class="sc">\n</span><span class="st">我</span><span class="sc">\n</span><span class="st">が</span><span class="sc">\n</span><span class="st">確</span><span class="sc">\n</span><span class="st">認</span><span class="sc">\n</span><span class="st">さ</span><span class="sc">\n</span><span class="st">れ</span><span class="sc">\n</span><span class="st">た</span><span class="sc">\n</span><span class="st">割</span><span class="sc">\n</span><span class="st">合&quot;</span>)<span class="ot">-&gt;</span> p_zibinom_glmm_b</span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="Chapter3.html#cb99-1" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb99-2"><a href="Chapter3.html#cb99-2" tabindex="-1"></a></span>
<span id="cb99-3"><a href="Chapter3.html#cb99-3" tabindex="-1"></a>p_zibinom_glmm_a <span class="sc">+</span> p_zibinom_glmm_b <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Zero-inflated-model-using-R_files/figure-html/unnamed-chunk-77-1.png" width="1248" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Chapter2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sessioninfo.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
